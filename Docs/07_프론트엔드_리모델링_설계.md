# 7. 프론트엔드 리모델링 설계

## 🎨 DN_SOLUTION2 프론트엔드 리모델링 설계

### 7.1 리모델링 개요

#### 7.1.1 현재 시스템 분석
```
현재 구조: React + Redux + Material-UI
문제점:
- 역할별 화면 분리 부족
- 동적 폼 처리 한계
- 권한 기반 UI 제어 미흡
- 정책별 주문서 양식 생성 복잡성
```

#### 7.1.2 리모델링 목표
```
✅ 역할별 UI/UX 최적화 (본사/협력사/판매점)
✅ 권한 기반 라우팅 및 컴포넌트 가드
✅ 동적 폼 시스템 구축
✅ 정책 하달 플로우 개선
✅ 리베이트 관리 시스템 강화
✅ 실시간 업데이트 및 반응형 디자인
```

### 7.2 역할별 정보구조 (IA) 설계

#### 7.2.1 본사 (Headquarters) IA
```
본사 주요 임무: 정책 하달, 협력사 관리, 주문서 승인

메뉴 구조:
📊 대시보드
  ├── 전사 지표 (정책/주문/리베이트/정산)
  ├── 승인 대기 알림
  └── 실시간 활동 피드

📋 정책 관리
  ├── 정책 목록/검색/필터
  ├── 정책 생성 (5단계 위저드)
  │   ├── 1단계: 협력사 그룹 선택
  │   ├── 2단계: 주문서 양식 생성
  │   ├── 3단계: 리베이트 매트릭스 설정
  │   ├── 4단계: 계약 조건 설정
  │   └── 5단계: 정책 배포
  ├── 정책 수정/삭제
  └── 정책 배포 현황

🏢 조직 관리
  ├── 협력사 목록/상세/승인
  ├── 판매점 현황 (협력사별)
  └── 계층 구조 시각화

📝 주문 승인
  ├── 승인 대기 큐
  ├── 주문 상세 검토
  ├── 승인/반려 처리
  └── 운송장 관리

💰 리베이트 관리
  ├── 협력사별 할당 관리
  ├── 할당 내역 조회
  └── 사용 현황 모니터링

📊 정산 관리
  ├── 협력사별 정산 집계
  ├── 정산 승인 처리
  └── 계층별 정산 내역

📈 리포트/엑셀
  ├── 전사 통계 대시보드
  ├── 정산 상세 내역 엑셀
  ├── 계층별 정산 내역 엑셀
  └── 커스텀 리포트 생성
```

#### 7.2.2 협력사 (Agency) IA
```
협력사 주요 임무: 판매점 관리, 정책 확인, 주문서 확인, 리베이트 분배

메뉴 구조:
📊 대시보드
  ├── 소속 지표 (정책/주문/리베이트)
  ├── 판매점 현황
  └── 알림 센터

📋 정책 관리 (조회 전용)
  ├── 배정받은 정책 목록
  ├── 정책 상세 조회
  ├── 주문서 양식 미리보기
  └── 리베이트 표 확인

🏪 판매점 관리
  ├── 예하 판매점 목록
  ├── 판매점 상세/수정
  ├── 판매점 승인 관리
  └── 판매점 성과 현황

📝 주문 관리
  ├── 예하 판매점 주문 현황
  ├── 주문 상세 조회
  ├── 주문 통계 (판매점별)
  └── 주문 검색/필터

💰 리베이트 관리
  ├── 내 리베이트 수령 현황
  ├── 판매점별 리베이트 분배
  ├── 분배 내역 관리
  └── 리베이트 잔액 현황

📊 정산 관리
  ├── 소속 판매점 정산 집계
  ├── 정산 내역 조회
  └── 정산 승인 처리

📈 리포트/엑셀
  ├── 소속 통계 대시보드
  ├── 내 리베이트 엑셀 다운로드
  ├── 판매점별 리베이트 엑셀
  └── 정산 내역 엑셀
```

#### 7.2.3 판매점 (Retail) IA
```
판매점 주요 임무: 정책 확인, 주문서 작성, 리베이트 확인

메뉴 구조:
📊 대시보드
  ├── 내 지표 (주문/리베이트/정산)
  ├── 이번 달 성과
  └── 알림 센터

📋 정책 관리 (조회 전용)
  ├── 적용 가능한 정책 목록
  ├── 정책 상세 조회
  ├── 주문서 양식 확인
  └── 리베이트 정보 확인

📝 주문 관리
  ├── 주문서 작성
  │   ├── 정책 선택
  │   ├── 통신사/요금제 선택
  │   ├── 고객 정보 입력
  │   └── 주문 제출
  ├── 내 주문 내역
  ├── 주문 상태 추적
  └── 주문 수정/취소

💰 리베이트 관리
  ├── 내 리베이트 수령 현황
  ├── 할당 잔액 확인
  ├── 사용 내역 조회
  └── 기간별 리베이트 조회

📊 정산 관리
  ├── 내 정산 내역
  ├── 월별 수익 현황
  └── 정산 상태 확인

📈 리포트/엑셀
  ├── 내 통계 대시보드
  ├── 내 리베이트 엑셀 다운로드
  ├── 주문 내역 엑셀
  └── 정산 내역 엑셀
```

### 7.3 라우팅 및 권한 가드 시스템

#### 7.3.1 라우팅 구조
```typescript
// routes.ts
export const routes = [
  // 공통 페이지
  { path: "/dashboard", roles: ["hq","agency","retail"] },

  // 정책 관리
  { path: "/policies", roles: ["hq","agency","retail"] },
  { path: "/policies/create", roles: ["hq"] },              // 본사만
  { path: "/policies/:id", roles: ["hq","agency","retail"] },
  { path: "/policies/:id/edit", roles: ["hq"] },            // 본사만

  // 주문 관리
  { path: "/orders", roles: ["hq","agency","retail"] },     // 가시 범위 다름
  { path: "/orders/create", roles: ["retail"] },            // 판매점만
  { path: "/orders/:id", roles: ["hq","agency","retail"] },
  { path: "/orders/:id/edit", roles: ["retail"] },          // 판매점만
  { path: "/orders/approval", roles: ["hq"] },              // 본사 승인 큐

  // 조직 관리
  { path: "/agencies", roles: ["hq"] },                     // 본사만
  { path: "/retailers", roles: ["hq","agency"] },           // 본사/협력사

  // 리베이트 관리
  { path: "/rebates/my", roles: ["agency","retail"] },      // 협력사/판매점
  { path: "/rebates/retailers", roles: ["agency"] },        // 협력사만
  { path: "/rebates/agencies", roles: ["hq"] },             // 본사만
  { path: "/rebates/allocate", roles: ["hq"] },             // 본사만
  { path: "/rebates/distribute", roles: ["agency"] },       // 협력사만

  // 정산 관리
  { path: "/settlements", roles: ["hq","agency","retail"] }, // 가시 범위 다름
  { path: "/settlements/approval", roles: ["hq"] },          // 본사만

  // 리포트/엑셀
  { path: "/reports", roles: ["hq","agency","retail"] },     // 권한별 다름
  { path: "/exports", roles: ["hq","agency","retail"] },     // 권한별 다름
];
```

#### 7.3.2 권한 가드 컴포넌트
```typescript
// RoleGuard.tsx
interface RoleGuardProps {
  roles: string[];
  children: React.ReactNode;
  fallback?: React.ReactNode;
}

const RoleGuard: React.FC<RoleGuardProps> = ({ roles, children, fallback = null }) => {
  const { user } = useAuth();
  
  if (!user || !roles.includes(user.company_type)) {
    return fallback || <Navigate to="/dashboard" replace />;
  }
  
  return <>{children}</>;
};

// 사용 예시
<RoleGuard roles={["hq"]}>
  <PolicyCreateButton />
</RoleGuard>
```

#### 7.3.3 메뉴 자동 필터링
```typescript
// Sidebar.tsx
const Sidebar = () => {
  const { user } = useAuth();
  
  const getFilteredMenuItems = () => {
    return menuItems.filter(item => 
      item.roles.includes(user?.company_type)
    );
  };
  
  return (
    <nav>
      {getFilteredMenuItems().map(item => (
        <NavLink key={item.path} to={item.path}>
          {item.label}
        </NavLink>
      ))}
    </nav>
  );
};
```

### 7.4 정책 하달 플로우 설계

#### 7.4.1 정책 생성 5단계 위저드 (본사 전용)
```typescript
// PolicyCreateWizard.tsx
const PolicyCreateWizard = () => {
  const [currentStep, setCurrentStep] = useState(1);
  const [policyData, setPolicyData] = useState({
    name: '',
    description: '',
    selectedCompanies: [],
    formFields: [],
    rebateMatrix: [],
    contractTerms: {},
  });

  const steps = [
    { id: 1, title: "협력사 그룹 선택", component: CompanyGroupSelector },
    { id: 2, title: "주문서 양식 생성", component: FormFieldBuilder },
    { id: 3, title: "리베이트 매트릭스", component: RebateMatrixEditor },
    { id: 4, title: "계약 조건 설정", component: ContractTermsEditor },
    { id: 5, title: "정책 배포", component: PolicyDeployment },
  ];

  return (
    <div className="policy-wizard">
      <WizardHeader steps={steps} currentStep={currentStep} />
      <WizardContent>
        {React.createElement(steps[currentStep - 1].component, {
          data: policyData,
          onChange: setPolicyData,
          onNext: () => setCurrentStep(currentStep + 1),
          onPrev: () => setCurrentStep(currentStep - 1),
        })}
      </WizardContent>
    </div>
  );
};
```

#### 7.4.2 1단계: 협력사 그룹 선택
```typescript
// CompanyGroupSelector.tsx
const CompanyGroupSelector = ({ data, onChange, onNext }) => {
  const [selectedAgencies, setSelectedAgencies] = useState([]);
  const [subordinateRetailers, setSubordinateRetailers] = useState([]);

  const handleAgencySelect = async (agencyIds) => {
    setSelectedAgencies(agencyIds);
    
    // 선택된 협력사의 예하 판매점 자동 조회
    const retailers = await fetchSubordinateRetailers(agencyIds);
    setSubordinateRetailers(retailers);
  };

  return (
    <div className="company-group-selector">
      <h3>정책을 적용할 협력사를 선택하세요</h3>
      
      <AgencyCheckboxList
        agencies={agencies}
        selectedIds={selectedAgencies}
        onChange={handleAgencySelect}
      />
      
      {subordinateRetailers.length > 0 && (
        <div className="subordinate-preview">
          <h4>자동 포함될 판매점 ({subordinateRetailers.length}개)</h4>
          <RetailerList retailers={subordinateRetailers} />
        </div>
      )}
      
      <WizardActions>
        <Button onClick={() => onNext({ selectedCompanies: [...selectedAgencies, ...subordinateRetailers] })}>
          다음 단계
        </Button>
      </WizardActions>
    </div>
  );
};
```

#### 7.4.3 2단계: 주문서 양식 생성
```typescript
// FormFieldBuilder.tsx
const FormFieldBuilder = ({ data, onChange, onNext }) => {
  const [availableFields] = useState([
    { id: 'customer_name', label: '고객명', type: 'text', required: true },
    { id: 'customer_phone', label: '연락처', type: 'text', required: true },
    { id: 'customer_address', label: '주소', type: 'text', required: false },
    { id: 'telecom_provider', label: '통신사', type: 'select', options: ['SKT', 'KT', 'LGU'] },
    { id: 'plan', label: '요금제', type: 'select', dependsOn: 'telecom_provider' },
    { id: 'device_model', label: '단말기 모델', type: 'text', required: false },
    { id: 'shipping_address', label: '배송 주소', type: 'text', required: false },
  ]);

  const [selectedFields, setSelectedFields] = useState([]);

  return (
    <div className="form-field-builder">
      <div className="field-library">
        <h3>사용 가능한 필드</h3>
        {availableFields.map(field => (
          <FieldCard
            key={field.id}
            field={field}
            onAdd={() => addField(field)}
          />
        ))}
      </div>
      
      <div className="form-preview">
        <h3>주문서 양식 미리보기</h3>
        <DraggableFieldList
          fields={selectedFields}
          onReorder={setSelectedFields}
          onRemove={removeField}
          onConfigure={configureField}
        />
      </div>
    </div>
  );
};
```

#### 7.4.4 3단계: 리베이트 매트릭스 설정
```typescript
// RebateMatrixEditor.tsx
const RebateMatrixEditor = ({ data, onChange, onNext }) => {
  const telecomProviders = ['SKT', 'KT', 'LGU'];
  const planCategories = ['10K+', '8K', '6K', '4K'];
  
  const [rebateMatrix, setRebateMatrix] = useState(() => {
    // 통신사 × 요금제 카테고리 매트릭스 초기화
    return telecomProviders.flatMap(provider =>
      planCategories.map(category => ({
        provider,
        category,
        amount: 0,
      }))
    );
  });

  return (
    <div className="rebate-matrix-editor">
      <h3>통신사별 요금제 리베이트 설정</h3>
      
      <table className="rebate-matrix">
        <thead>
          <tr>
            <th>통신사</th>
            {planCategories.map(category => (
              <th key={category}>{category}</th>
            ))}
          </tr>
        </thead>
        <tbody>
          {telecomProviders.map(provider => (
            <tr key={provider}>
              <td className="provider-name">{provider}</td>
              {planCategories.map(category => (
                <td key={`${provider}-${category}`}>
                  <CurrencyInput
                    value={getRebateAmount(provider, category)}
                    onChange={(amount) => setRebateAmount(provider, category, amount)}
                  />
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
      
      <div className="matrix-actions">
        <Button variant="secondary" onClick={importFromExcel}>
          엑셀에서 가져오기
        </Button>
        <Button variant="secondary" onClick={applyTemplate}>
          템플릿 적용
        </Button>
      </div>
    </div>
  );
};
```

### 7.5 동적 주문서 양식 시스템

#### 7.5.1 JSON 스키마 정의
```typescript
// FormSchema.ts
interface FormFieldSchema {
  id: string;
  label: string;
  type: 'text' | 'select' | 'date' | 'checkbox' | 'radio' | 'file';
  required: boolean;
  order: number;
  options?: string[];
  dependsOn?: string;
  optionsSource?: string; // API 엔드포인트
  validation?: {
    pattern?: string;
    minLength?: number;
    maxLength?: number;
    min?: number;
    max?: number;
  };
  mask?: 'phone' | 'business-number' | 'credit-card';
  placeholder?: string;
  helpText?: string;
}

interface PolicyFormSchema {
  policyId: string;
  policyName: string;
  fields: FormFieldSchema[];
}
```

#### 7.5.2 동적 폼 렌더러
```typescript
// DynamicFormRenderer.tsx
const DynamicFormRenderer = ({ schema, onSubmit, initialData = {} }) => {
  const [formData, setFormData] = useState(initialData);
  const [fieldOptions, setFieldOptions] = useState({});

  // 의존성 필드 처리
  useEffect(() => {
    schema.fields.forEach(field => {
      if (field.dependsOn && field.optionsSource) {
        const dependencyValue = formData[field.dependsOn];
        if (dependencyValue) {
          loadFieldOptions(field.id, field.optionsSource, dependencyValue);
        }
      }
    });
  }, [formData, schema.fields]);

  const loadFieldOptions = async (fieldId, source, dependencyValue) => {
    try {
      const url = source.replace(`{${field.dependsOn}}`, dependencyValue);
      const response = await api.get(url);
      setFieldOptions(prev => ({
        ...prev,
        [fieldId]: response.data
      }));
    } catch (error) {
      console.error(`Failed to load options for ${fieldId}:`, error);
    }
  };

  const renderField = (field: FormFieldSchema) => {
    const commonProps = {
      key: field.id,
      name: field.id,
      label: field.label,
      required: field.required,
      value: formData[field.id] || '',
      onChange: (value) => setFormData(prev => ({ ...prev, [field.id]: value })),
      helpText: field.helpText,
      placeholder: field.placeholder,
    };

    switch (field.type) {
      case 'text':
        return (
          <TextInput
            {...commonProps}
            mask={field.mask}
            validation={field.validation}
          />
        );
      
      case 'select':
        return (
          <SelectInput
            {...commonProps}
            options={fieldOptions[field.id] || field.options || []}
            loading={field.dependsOn && !fieldOptions[field.id]}
          />
        );
      
      case 'date':
        return <DateInput {...commonProps} />;
      
      case 'checkbox':
        return (
          <CheckboxInput
            {...commonProps}
            options={field.options || []}
          />
        );
      
      case 'file':
        return (
          <FileInput
            {...commonProps}
            accept={field.validation?.pattern}
          />
        );
      
      default:
        return null;
    }
  };

  const sortedFields = schema.fields.sort((a, b) => a.order - b.order);

  return (
    <form onSubmit={(e) => { e.preventDefault(); onSubmit(formData); }}>
      <div className="dynamic-form">
        {sortedFields.map(renderField)}
      </div>
      
      <div className="form-actions">
        <Button type="submit" variant="primary">
          주문서 제출
        </Button>
      </div>
    </form>
  );
};
```

### 7.6 리베이트 관리 시스템

#### 7.6.1 3단계 리베이트 흐름
```typescript
// RebateFlowDiagram.tsx
const RebateFlow = {
  // 1단계: 본사 → 협력사 할당
  allocation: {
    actor: "본사 (HQ)",
    action: "협력사별 리베이트 할당",
    component: "RebateAllocator",
    api: "POST /api/rebates/allocate",
  },
  
  // 2단계: 협력사 → 판매점 분배
  distribution: {
    actor: "협력사 (Agency)", 
    action: "예하 판매점에 리베이트 분배",
    component: "RebateDistributor",
    api: "POST /api/rebates/distribute",
  },
  
  // 3단계: 판매점 → 주문 시 사용
  usage: {
    actor: "판매점 (Retail)",
    action: "주문 생성 시 리베이트 차감",
    component: "RebateBalance",
    api: "GET/PUT /api/rebates/balance",
  },
};
```

#### 7.6.2 리베이트 할당 컴포넌트 (본사)
```typescript
// RebateAllocator.tsx
const RebateAllocator = () => {
  const [selectedPeriod, setSelectedPeriod] = useState({
    startDate: '',
    endDate: '',
  });
  const [agencies, setAgencies] = useState([]);
  const [allocations, setAllocations] = useState([]);

  const handleBulkAllocate = async () => {
    try {
      await api.post('/api/rebates/allocate/bulk', {
        period: selectedPeriod,
        allocations: allocations,
      });
      
      toast.success('리베이트 할당이 완료되었습니다.');
      
      // 협력사들에게 실시간 알림
      await sendNotification('rebate_allocated', allocations.map(a => a.agencyId));
      
    } catch (error) {
      toast.error('리베이트 할당에 실패했습니다.');
    }
  };

  return (
    <div className="rebate-allocator">
      <div className="period-selector">
        <DateRangePicker
          startDate={selectedPeriod.startDate}
          endDate={selectedPeriod.endDate}
          onChange={setSelectedPeriod}
        />
      </div>
      
      <div className="allocation-table">
        <DataTable
          columns={[
            { key: 'agencyName', title: '협력사명' },
            { key: 'currentBalance', title: '현재 잔액' },
            { key: 'allocationAmount', title: '할당 금액', editable: true },
            { key: 'totalBalance', title: '할당 후 잔액' },
          ]}
          data={agencies}
          onChange={setAllocations}
        />
      </div>
      
      <div className="allocation-summary">
        <SummaryCard
          totalAmount={allocations.reduce((sum, a) => sum + a.amount, 0)}
          agencyCount={allocations.length}
        />
      </div>
      
      <div className="actions">
        <Button onClick={handleBulkAllocate} variant="primary">
          일괄 할당
        </Button>
      </div>
    </div>
  );
};
```

### 7.7 역할별 대시보드 설계

#### 7.7.1 본사 대시보드
```typescript
// HQDashboard.tsx
const HQDashboard = () => {
  const [dashboardData, setDashboardData] = useState(null);

  return (
    <DashboardLayout>
      <div className="dashboard-grid hq-dashboard">
        {/* 전사 지표 */}
        <MetricCard
          title="전체 정책"
          value={dashboardData?.totalPolicies}
          trend="+12%"
          icon="policy"
        />
        
        <MetricCard
          title="승인 대기 주문"
          value={dashboardData?.pendingOrders}
          status="warning"
          icon="pending"
        />
        
        <MetricCard
          title="이번 달 리베이트"
          value={formatCurrency(dashboardData?.monthlyRebate)}
          trend="+8%"
          icon="money"
        />
        
        {/* 승인 큐 위젯 */}
        <ApprovalQueueWidget
          pendingOrders={dashboardData?.approvalQueue}
          onApprove={handleOrderApprove}
        />
        
        {/* 협력사 현황 */}
        <AgencyStatusWidget
          agencies={dashboardData?.agencies}
        />
        
        {/* 실시간 활동 피드 */}
        <ActivityFeedWidget
          activities={dashboardData?.recentActivities}
        />
        
        {/* 정산 현황 차트 */}
        <SettlementChartWidget
          data={dashboardData?.settlementTrend}
        />
      </div>
    </DashboardLayout>
  );
};
```

#### 7.7.2 협력사 대시보드
```typescript
// AgencyDashboard.tsx
const AgencyDashboard = () => {
  return (
    <DashboardLayout>
      <div className="dashboard-grid agency-dashboard">
        {/* 소속 지표 */}
        <MetricCard
          title="배정받은 정책"
          value={dashboardData?.assignedPolicies}
          icon="policy"
        />
        
        <MetricCard
          title="예하 판매점"
          value={dashboardData?.retailerCount}
          status="success"
          icon="store"
        />
        
        <MetricCard
          title="이번 달 리베이트"
          value={formatCurrency(dashboardData?.myRebate)}
          trend="+5%"
          icon="money"
        />
        
        {/* 판매점 현황 */}
        <RetailerStatusWidget
          retailers={dashboardData?.retailers}
        />
        
        {/* 리베이트 분배 현황 */}
        <RebateDistributionWidget
          distributions={dashboardData?.rebateDistribution}
        />
        
        {/* 주문 현황 차트 */}
        <OrderTrendWidget
          data={dashboardData?.orderTrend}
        />
      </div>
    </DashboardLayout>
  );
};
```

#### 7.7.3 판매점 대시보드
```typescript
// RetailDashboard.tsx  
const RetailDashboard = () => {
  return (
    <DashboardLayout>
      <div className="dashboard-grid retail-dashboard">
        {/* 내 지표 */}
        <MetricCard
          title="이번 달 주문"
          value={dashboardData?.monthlyOrders}
          trend="+15%"
          icon="order"
        />
        
        <MetricCard
          title="리베이트 잔액"
          value={formatCurrency(dashboardData?.rebateBalance)}
          status="info"
          icon="wallet"
        />
        
        <MetricCard
          title="이번 달 수익"
          value={formatCurrency(dashboardData?.monthlyProfit)}
          trend="+20%"
          icon="profit"
        />
        
        {/* 주문 생성 바로가기 */}
        <QuickOrderWidget
          availablePolicies={dashboardData?.availablePolicies}
          onCreateOrder={handleCreateOrder}
        />
        
        {/* 최근 주문 현황 */}
        <RecentOrdersWidget
          orders={dashboardData?.recentOrders}
        />
        
        {/* 리베이트 사용 현황 */}
        <RebateUsageWidget
          usage={dashboardData?.rebateUsage}
        />
      </div>
    </DashboardLayout>
  );
};
```

### 7.8 엑셀 다운로드 시스템

#### 7.8.1 역할별 엑셀 다운로드 권한
```typescript
// ExcelExportCenter.tsx
const ExcelExportCenter = () => {
  const { user } = useAuth();
  
  const getAvailableExports = () => {
    const baseExports = [
      { id: 'orders', title: '주문 내역', scope: 'own' },
      { id: 'rebates', title: '리베이트 내역', scope: 'own' },
    ];
    
    switch (user.company_type) {
      case 'hq':
        return [
          ...baseExports,
          { id: 'settlements_detailed', title: '정산 상세 내역', scope: 'all' },
          { id: 'settlements_hierarchical', title: '계층별 정산 내역', scope: 'all' },
          { id: 'agency_rebates', title: '협력사 리베이트 현황', scope: 'subordinates' },
          { id: 'policy_distribution', title: '정책 배포 현황', scope: 'all' },
        ];
        
      case 'agency':
        return [
          ...baseExports,
          { id: 'retailer_rebates', title: '판매점 리베이트 현황', scope: 'subordinates' },
          { id: 'retailer_orders', title: '판매점 주문 현황', scope: 'subordinates' },
        ];
        
      case 'retail':
        return baseExports;
        
      default:
        return [];
    }
  };

  return (
    <div className="excel-export-center">
      <div className="export-filters">
        <DateRangePicker
          startDate={filters.startDate}
          endDate={filters.endDate}
          onChange={setFilters}
        />
        
        <CompanyScopeFilter
          userRole={user.company_type}
          selectedCompanies={filters.companies}
          onChange={(companies) => setFilters(prev => ({ ...prev, companies }))}
        />
      </div>
      
      <div className="export-options">
        {getAvailableExports().map(exportOption => (
          <ExportCard
            key={exportOption.id}
            title={exportOption.title}
            scope={exportOption.scope}
            onExport={() => handleExport(exportOption.id)}
          />
        ))}
      </div>
    </div>
  );
};
```

### 7.9 실시간 업데이트 시스템

#### 7.9.1 WebSocket 연결 관리
```typescript
// useWebSocket.ts
const useWebSocket = () => {
  const { user } = useAuth();
  const [socket, setSocket] = useState(null);

  useEffect(() => {
    if (user) {
      const ws = new WebSocket(`ws://localhost:8000/ws/notifications/${user.company_id}/`);
      
      ws.onmessage = (event) => {
        const notification = JSON.parse(event.data);
        handleNotification(notification);
      };
      
      setSocket(ws);
      
      return () => {
        ws.close();
      };
    }
  }, [user]);

  const handleNotification = (notification) => {
    switch (notification.type) {
      case 'order_created':
        // 주문 생성 알림
        toast.info(`새로운 주문이 접수되었습니다: ${notification.order_id}`);
        // 대시보드 데이터 새로고침
        queryClient.invalidateQueries('dashboard');
        break;
        
      case 'order_approved':
        toast.success(`주문이 승인되었습니다: ${notification.order_id}`);
        break;
        
      case 'rebate_allocated':
        toast.info(`리베이트가 할당되었습니다: ${notification.amount}원`);
        queryClient.invalidateQueries('rebates');
        break;
        
      case 'policy_assigned':
        toast.info(`새로운 정책이 배정되었습니다: ${notification.policy_name}`);
        queryClient.invalidateQueries('policies');
        break;
    }
  };

  return socket;
};
```

### 7.10 구현 우선순위

#### 7.10.1 Phase 1: 핵심 인프라 (4주)
```
✅ 권한 기반 라우팅 시스템
✅ RoleGuard 컴포넌트
✅ 역할별 메뉴 자동 필터링
✅ 기본 대시보드 레이아웃
```

#### 7.10.2 Phase 2: 정책 관리 (6주)
```
✅ 정책 생성 5단계 위저드
✅ 동적 폼 시스템
✅ 리베이트 매트릭스 에디터
✅ 정책 조회 전용 페이지 (협력사/판매점)
```

#### 7.10.3 Phase 3: 주문 시스템 (6주)
```
✅ 동적 주문서 렌더러
✅ 주문 승인 큐 (본사)
✅ 주문 상태 추적
✅ 민감정보 처리
```

#### 7.10.4 Phase 4: 리베이트 시스템 (4주)
```
✅ 3단계 리베이트 흐름
✅ 리베이트 할당/분배/사용
✅ 정산 자동화
✅ 승인 워크플로우
```

#### 7.10.5 Phase 5: 최적화 (3주)
```
✅ 실시간 업데이트 (WebSocket)
✅ 엑셀 다운로드 시스템
✅ 성능 최적화
✅ 반응형 디자인
```

이 문서는 DN_Solution2의 프론트엔드 리모델링을 위한 완전한 설계 가이드입니다.