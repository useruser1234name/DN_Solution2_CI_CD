# 1. 시스템 개요

## 🏢 DN_SOLUTION2 시스템 개요

### 1.1 핵심 비즈니스 모델
```
본사 (HQ) → 협력사 (Agency) → 판매점 (Retailer) → 고객 (Customer)
├── 본사: 정책 생성, 리베이트 할당, 주문 승인
├── 협력사: 리베이트 분배, 하위 판매점 관리
├── 판매점: 고객 주문 처리, 정책 선택
└── 고객: 상품 구매, 서비스 이용
```

### 1.2 주요 기능
```
✅ 계층별 업체 관리 (본사 → 협력사 → 판매점)
✅ 통합 회원가입 (업체 + 관리자 동시 생성)
✅ 동적 정책 생성 (업체 선택 → 주문서 양식 → 리베이트 설정)
✅ 통신사별 요금제 기준 리베이트 시스템
✅ 상품 가격 관리 (매입가/판매가/마진)
✅ 주문서 작성 및 승인 플로우
✅ 리베이트 할당 및 정산 시스템
✅ 엑셀 다운로드 기능
✅ 실시간 대시보드
✅ 권한 기반 접근 제어
```

### 1.3 시스템 아키텍처

#### 1.3.1 백엔드 (Django)
```
Django Framework
├── Django REST Framework (API)
├── Django-CTE (계층 구조 쿼리)
├── Django-CORS-Headers (CORS)
├── Simple JWT (인증)
└── PostgreSQL (데이터베이스)
```

#### 1.3.2 프론트엔드 (React)
```
React Application
├── Redux Toolkit (상태 관리)
├── React Router (라우팅)
├── Axios (API 통신)
└── Material-UI (UI 컴포넌트)
```

### 1.4 핵심 비즈니스 로직

#### 1.4.1 계층별 권한 관리
```
본사 (HQ)
├── 모든 업체 정보 조회/수정
├── 모든 주문 정보 조회/수정
├── 리베이트 할당/관리
├── 정책 생성/수정/삭제
├── 상품 가격 관리
├── 전체 통계 조회
├── 정산 승인
└── 시스템 설정 관리

협력사 (Agency)
├── 본사 정보 조회
├── 하위 판매점 정보 조회/수정
├── 본사 주문 정보 조회
├── 하위 판매점 주문 정보 조회
├── 할당받은 리베이트 관리
├── 하위 판매점에 리베이트 분배
├── 상품 가격 조회
├── 하위 판매점 정산 승인
└── 본인 통계 조회

판매점 (Retailer)
├── 상위 협력사 정보 조회
├── 본사 정보 조회
├── 본사 주문 정보 조회
├── 본인 주문 정보 생성/조회/수정
├── 할당받은 리베이트 사용
├── 상품 가격 조회
├── 본인 정산 확인
└── 본인 통계 조회
```

#### 1.4.2 리베이트 시스템
```
본사 → 협력사 할당
├── 기간 설정 (예: 2024-08-01 ~ 2024-08-31)
├── 금액 할당 (예: 협력사 A에 5,000,000원)
└── 사용 조건 설정

협력사 → 판매점 분배
├── 할당받은 금액 분배
├── 판매점별 금액 설정
└── 잔액 관리

판매점 → 주문 시 사용
├── 정책별 리베이트 적용
├── 요금제별 차등 리베이트
└── 자동 정산 처리
```

#### 1.4.3 정책 생성 시스템
```
1단계: 업체 그룹 선택
├── 협력사 목록에서 체크박스 선택
├── 선택된 협력사와 하위 판매점 그룹화
└── 그룹명 설정

2단계: 주문서 양식 작성
├── 미리 정의된 항목들 중에서 선택
├── 필수/선택 항목 구분
└── 드롭다운/직접입력 설정

3단계: 리베이트 설정
├── SKT 요금제별 리베이트 (10K 이상: 200,000원)
├── KT 요금제별 리베이트 (10K 이상: 180,000원)
└── LGU 요금제별 리베이트 (10K 이상: 160,000원)

4단계: 계약 조건 설정
├── 최소 계약 유지일: 24개월
├── 위약금: 50,000원
└── 기타 조건 설정

5단계: 정책 활성화
├── 선택된 업체들에게 정책 배정
├── 주문서 양식 생성
└── 정책 활성화
```

### 1.5 데이터 흐름

#### 1.5.1 회원가입 흐름
```
사용자 → 회원 유형 선택 → 상위 업체코드 입력 → 업체코드 검증 → 업체 정보 입력 → 관리자 정보 입력 → 업체코드 자동 생성 → 업체+관리자 동시 생성 → 업체코드 표시 → 승인 대기 → 승인 → 로그인 가능
```

#### 1.5.2 정책 생성 흐름
```
본사 관리자 → 업체 선택 → 그룹 생성 → 주문서 양식 정의 → 통신사별 리베이트 설정 → 계약 조건 설정 → 정책 활성화
```

#### 1.5.3 주문 처리 흐름
```
판매점 → 정책 선택 → 요금제 선택 → 상품 선택 → 고객 정보 입력 → 최종 계산 → 주문서 제출 → 본사 검토 → 승인/반려 → 상품 발송 → 운송장번호 입력 → 리베이트 정산
```

#### 1.5.4 리베이트 할당 흐름
```
본사 → 협력사 할당 → 협력사 → 판매점 분배 → 판매점 → 주문 시 사용 → 정산 처리
```

### 1.6 시스템 특징

#### 1.6.1 실시간 업데이트
```
✅ 자동 새로고침 (30초 간격)
✅ WebSocket 실시간 업데이트
✅ 사용자 설정 가능
✅ 실시간 알림 시스템
```

#### 1.6.2 엑셀 다운로드
```
✅ 정산 상세 내역 (모든 업체)
✅ 계층별 정산 내역 (본사용)
✅ 주문 내역 (모든 업체)
✅ 리베이트 내역 (모든 업체)
```

#### 1.6.3 권한 관리
```
✅ 계층별 데이터 접근 제어
✅ 역할별 권한 설정
✅ 실시간 권한 검증
✅ 안전한 API 접근
```

### 1.7 기술 스택

#### 1.7.1 백엔드
```
- Django 4.2+
- Django REST Framework
- Django-CTE
- PostgreSQL
- Redis
- Celery (비동기 작업)
- Gunicorn (WSGI 서버)
```

#### 1.7.2 프론트엔드
```
- React 18+
- Redux Toolkit
- React Router
- Axios
- Material-UI
- Chart.js (차트)
- React Hook Form (폼 관리)
```

#### 1.7.3 인프라
```
- Docker
- Nginx
- PostgreSQL
- Redis
- AWS/GCP (클라우드)
```

### 1.8 성능 최적화

#### 1.8.1 데이터베이스 최적화
```
✅ 인덱스 설정
✅ 쿼리 최적화
✅ CTE 활용
✅ 캐싱 전략
```

#### 1.8.2 프론트엔드 최적화
```
✅ 코드 스플리팅
✅ 지연 로딩
✅ 메모이제이션
✅ 가상화 (대용량 리스트)
```

### 1.9 보안

#### 1.9.1 인증 및 권한
```
✅ JWT 토큰 기반 인증
✅ 토큰 갱신 메커니즘
✅ 권한 기반 접근 제어
✅ 세션 관리
```

#### 1.9.2 데이터 보안
```
✅ HTTPS 강제
✅ SQL 인젝션 방지
✅ XSS 방지
✅ CSRF 보호
```

### 1.10 확장성

#### 1.10.1 수평 확장
```
✅ 로드 밸런싱
✅ 데이터베이스 샤딩
✅ 캐시 클러스터링
✅ 마이크로서비스 아키텍처
```

#### 1.10.2 기능 확장
```
✅ 플러그인 시스템
✅ API 버전 관리
✅ 모듈화된 구조
✅ 설정 기반 동작
```

이 시스템은 계층별 업체 관리, 동적 정책 생성, 리베이트 할당 및 정산 시스템을 제공하는 종합적인 비즈니스 관리 플랫폼입니다.
