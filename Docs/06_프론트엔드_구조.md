# 6. 프론트엔드 구조

## 🎨 DN_SOLUTION2 프론트엔드 구조

### 6.1 페이지 구조

#### 6.1.1 전체 페이지 구조
```
/login - 로그인
/signup - 통합 회원가입
/forgot-password - 비밀번호 찾기
/dashboard - 메인 대시보드
/statistics - 통계 페이지
/companies - 업체 목록
/companies/create - 업체 생성
/companies/{id} - 업체 상세
/companies/{id}/edit - 업체 수정
/policies - 정책 목록
/policies/create - 정책 생성 (단계별)
/policies/{id} - 정책 상세
/policies/{id}/edit - 정책 수정
/orders - 주문 목록
/orders/create - 주문 생성
/orders/{id} - 주문 상세
/orders/{id}/edit - 주문 수정
/rebates - 리베이트 관리
/rebates/allocations - 할당 관리
/rebates/settlements - 정산 관리
/product-prices - 상품 가격 관리
/product-prices/create - 상품 가격 추가
/product-prices/{id}/edit - 상품 가격 수정
```

#### 6.1.2 라우팅 구조
```javascript
// App.js
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';

function App() {
  return (
    <Router>
      <Routes>
        {/* 공개 페이지 */}
        <Route path="/login" element={<LoginPage />} />
        <Route path="/signup" element={<SignupPage />} />
        <Route path="/forgot-password" element={<ForgotPasswordPage />} />
        
        {/* 보호된 페이지 */}
        <Route path="/" element={<ProtectedRoute><MainLayout /></ProtectedRoute>}>
          <Route index element={<DashboardPage />} />
          <Route path="dashboard" element={<DashboardPage />} />
          <Route path="statistics" element={<StatisticsPage />} />
          
          {/* 업체 관리 */}
          <Route path="companies" element={<CompanyListPage />} />
          <Route path="companies/create" element={<CompanyCreatePage />} />
          <Route path="companies/:id" element={<CompanyDetailPage />} />
          <Route path="companies/:id/edit" element={<CompanyEditPage />} />
          
          {/* 정책 관리 */}
          <Route path="policies" element={<PolicyListPage />} />
          <Route path="policies/create" element={<PolicyCreatePage />} />
          <Route path="policies/:id" element={<PolicyDetailPage />} />
          <Route path="policies/:id/edit" element={<PolicyEditPage />} />
          
          {/* 주문 관리 */}
          <Route path="orders" element={<OrderListPage />} />
          <Route path="orders/create" element={<OrderCreatePage />} />
          <Route path="orders/:id" element={<OrderDetailPage />} />
          <Route path="orders/:id/edit" element={<OrderEditPage />} />
          
          {/* 리베이트 관리 */}
          <Route path="rebates" element={<RebatePage />} />
          <Route path="rebates/allocations" element={<RebateAllocationPage />} />
          <Route path="rebates/settlements" element={<RebateSettlementPage />} />
          
          {/* 상품 가격 관리 */}
          <Route path="product-prices" element={<ProductPriceListPage />} />
          <Route path="product-prices/create" element={<ProductPriceCreatePage />} />
          <Route path="product-prices/:id/edit" element={<ProductPriceEditPage />} />
        </Route>
      </Routes>
    </Router>
  );
}
```

### 6.2 컴포넌트 구조

#### 6.2.1 전체 컴포넌트 구조
```
src/
├── components/
│   ├── ProtectedRoute.js - 권한 기반 라우트
│   ├── Sidebar.js - 사이드바
│   ├── ExcelDownload.js - 엑셀 다운로드
│   ├── SettlementSummary.js - 정산 요약
│   ├── OrderSummary.js - 주문 요약
│   ├── RebateSummary.js - 리베이트 요약
│   └── HierarchicalSettlement.js - 계층별 정산
├── pages/
│   ├── LoginPage.js - 로그인
│   ├── SignupPage.js - 회원가입
│   ├── DashboardPage.js - 대시보드
│   ├── CompanyListPage.js - 업체 목록
│   ├── PolicyListPage.js - 정책 목록
│   ├── OrderListPage.js - 주문 목록
│   └── RebatePage.js - 리베이트 관리
├── features/
│   ├── auth/
│   │   └── authSlice.js - 인증 상태 관리
│   ├── policies/
│   │   └── policySlice.js - 정책 상태 관리
│   └── orders/
│       └── orderSlice.js - 주문 상태 관리
├── services/
│   └── api.js - API 통신
└── utils/
    ├── permissions.js - 권한 관리
    └── formatters.js - 데이터 포맷팅
```

#### 6.2.2 공통 컴포넌트

##### 6.2.2.1 ProtectedRoute 컴포넌트
```javascript
// components/ProtectedRoute.js
import { useSelector } from 'react-redux';
import { Navigate } from 'react-router-dom';

const ProtectedRoute = ({ children, requiredPermissions = [] }) => {
  const { isAuthenticated, user } = useSelector(state => state.auth);
  
  if (!isAuthenticated) {
    return <Navigate to="/login" replace />;
  }
  
  if (requiredPermissions.length > 0) {
    const hasPermission = requiredPermissions.every(permission => 
      user.permissions.includes(permission)
    );
    
    if (!hasPermission) {
      return <Navigate to="/dashboard" replace />;
    }
  }
  
  return children;
};

export default ProtectedRoute;
```

##### 6.2.2.2 Sidebar 컴포넌트
```javascript
// components/Sidebar.js
import { useSelector, useDispatch } from 'react-redux';
import { logout } from '../features/auth/authSlice';

const Sidebar = () => {
  const dispatch = useDispatch();
  const { user } = useSelector(state => state.auth);
  
  const menuItems = [
    {
      title: '대시보드',
      path: '/dashboard',
      icon: 'dashboard',
      permission: 'dashboard'
    },
    {
      title: '업체 관리',
      path: '/companies',
      icon: 'business',
      permission: 'company_read'
    },
    {
      title: '정책 관리',
      path: '/policies',
      icon: 'policy',
      permission: 'policy_read'
    },
    {
      title: '주문 관리',
      path: '/orders',
      icon: 'order',
      permission: 'order_read'
    },
    {
      title: '리베이트 관리',
      path: '/rebates',
      icon: 'money',
      permission: 'rebate_read'
    },
    {
      title: '상품 가격',
      path: '/product-prices',
      icon: 'price',
      permission: 'product_price_read'
    }
  ];
  
  const handleLogout = () => {
    dispatch(logout());
  };
  
  return (
    <div className="sidebar">
      <div className="sidebar-header">
        <h2>DN_SOLUTION2</h2>
      </div>
      
      <nav className="sidebar-nav">
        {menuItems.map(item => (
          <PermissionGuard key={item.path} permission={item.permission}>
            <NavLink to={item.path} className="nav-item">
              <i className={`icon-${item.icon}`}></i>
              <span>{item.title}</span>
            </NavLink>
          </PermissionGuard>
        ))}
      </nav>
      
      <div className="sidebar-footer">
        <div className="user-info">
          <span className="username">{user?.username || '사용자'}</span>
          <span className="role">{user?.role || '역할'}</span>
          {user?.email && (
            <span className="email">{user.email}</span>
          )}
        </div>
        <button className="logout-btn" onClick={handleLogout}>
          로그아웃
        </button>
      </div>
    </div>
  );
};

export default Sidebar;
```

##### 6.2.2.3 ExcelDownload 컴포넌트
```javascript
// components/ExcelDownload.js
import { useState } from 'react';
import { downloadExcel } from '../services/api';

const ExcelDownload = ({ companyType }) => {
  const [startDate, setStartDate] = useState('');
  const [endDate, setEndDate] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  
  const handleDownload = async (type) => {
    if (!startDate || !endDate) {
      alert('시작일과 종료일을 선택해주세요.');
      return;
    }
    
    setIsLoading(true);
    try {
      await downloadExcel(type, startDate, endDate);
    } catch (error) {
      console.error('엑셀 다운로드 실패:', error);
      alert('엑셀 다운로드에 실패했습니다.');
    } finally {
      setIsLoading(false);
    }
  };
  
  return (
    <div className="excel-download">
      <h3>엑셀 다운로드</h3>
      
      <div className="date-range">
        <div className="date-input">
          <label>시작일:</label>
          <input
            type="date"
            value={startDate}
            onChange={(e) => setStartDate(e.target.value)}
          />
        </div>
        <div className="date-input">
          <label>종료일:</label>
          <input
            type="date"
            value={endDate}
            onChange={(e) => setEndDate(e.target.value)}
          />
        </div>
      </div>
      
      <div className="download-buttons">
        <button
          onClick={() => handleDownload('settlements')}
          disabled={isLoading}
        >
          정산 상세 내역 다운로드
        </button>
        
        {companyType === 'headquarters' && (
          <button
            onClick={() => handleDownload('hierarchical')}
            disabled={isLoading}
          >
            계층별 정산 내역 다운로드
          </button>
        )}
        
        <button
          onClick={() => handleDownload('orders')}
          disabled={isLoading}
        >
          주문 내역 다운로드
        </button>
        
        <button
          onClick={() => handleDownload('rebates')}
          disabled={isLoading}
        >
          리베이트 내역 다운로드
        </button>
      </div>
      
      {isLoading && <div className="loading">다운로드 중...</div>}
    </div>
  );
};

export default ExcelDownload;
```

### 6.3 페이지 컴포넌트

#### 6.3.1 로그인 페이지
```javascript
// pages/LoginPage.js
import { useState } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { useNavigate } from 'react-router-dom';
import { login } from '../features/auth/authSlice';

const LoginPage = () => {
  const dispatch = useDispatch();
  const navigate = useNavigate();
  const { loading, error } = useSelector(state => state.auth);
  
  const [formData, setFormData] = useState({
    username: '',
    password: ''
  });
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    try {
      await dispatch(login(formData)).unwrap();
      navigate('/dashboard');
    } catch (error) {
      console.error('로그인 실패:', error);
    }
  };
  
  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };
  
  return (
    <div className="login-page">
      <div className="login-container">
        <h1>DN_SOLUTION2</h1>
        <h2>로그인</h2>
        
        <form onSubmit={handleSubmit}>
          <div className="form-group">
            <label>아이디</label>
            <input
              type="text"
              name="username"
              value={formData.username}
              onChange={handleChange}
              required
            />
          </div>
          
          <div className="form-group">
            <label>비밀번호</label>
            <input
              type="password"
              name="password"
              value={formData.password}
              onChange={handleChange}
              required
            />
          </div>
          
          {error && <div className="error-message">{error}</div>}
          
          <button type="submit" disabled={loading}>
            {loading ? '로그인 중...' : '로그인'}
          </button>
        </form>
        
        <div className="login-links">
          <a href="/signup">회원가입</a>
          <a href="/forgot-password">비밀번호 찾기</a>
        </div>
      </div>
    </div>
  );
};

export default LoginPage;
```

#### 6.3.2 회원가입 페이지
```javascript
// pages/SignupPage.js
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { signup } from '../services/api';

const SignupPage = () => {
  const navigate = useNavigate();
  const [step, setStep] = useState(1);
  const [formData, setFormData] = useState({
    user_type: '',
    parent_company_code: '',
    company: {
      name: '',
      business_number: '',
      address: '',
      contact_number: ''
    },
    admin: {
      username: '',
      password: '',
      email: '',
      contact_name: '',
      contact_phone: ''
    }
  });
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    try {
      const response = await signup(formData);
      alert(`회원가입이 완료되었습니다. 업체코드: ${response.company_code}`);
      navigate('/login');
    } catch (error) {
      console.error('회원가입 실패:', error);
      alert('회원가입에 실패했습니다.');
    }
  };
  
  const handleChange = (e) => {
    const { name, value } = e.target;
    
    if (name.includes('.')) {
      const [section, field] = name.split('.');
      setFormData({
        ...formData,
        [section]: {
          ...formData[section],
          [field]: value
        }
      });
    } else {
      setFormData({
        ...formData,
        [name]: value
      });
    }
  };
  
  return (
    <div className="signup-page">
      <div className="signup-container">
        <h1>DN_SOLUTION2</h1>
        <h2>회원가입</h2>
        
        <form onSubmit={handleSubmit}>
          <div className="form-step">
            <h3>1단계: 회원 유형 선택</h3>
            <div className="form-group">
              <label>회원 유형</label>
              <select
                name="user_type"
                value={formData.user_type}
                onChange={handleChange}
                required
              >
                <option value="">선택하세요</option>
                <option value="headquarters">본사 관리자</option>
                <option value="agency">협력사 관리자</option>
                <option value="retail">판매점 직원</option>
              </select>
            </div>
          </div>
          
          {formData.user_type !== 'headquarters' && (
            <div className="form-step">
              <h3>2단계: 상위 업체코드 입력</h3>
              <div className="form-group">
                <label>상위 업체코드</label>
                <input
                  type="text"
                  name="parent_company_code"
                  value={formData.parent_company_code}
                  onChange={handleChange}
                  required
                  placeholder="상위 업체코드를 입력하세요"
                />
              </div>
            </div>
          )}
          
          <div className="form-step">
            <h3>3단계: 업체 정보 입력</h3>
            <div className="form-group">
              <label>업체명</label>
              <input
                type="text"
                name="company.name"
                value={formData.company.name}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>사업자등록번호</label>
              <input
                type="text"
                name="company.business_number"
                value={formData.company.business_number}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>주소</label>
              <input
                type="text"
                name="company.address"
                value={formData.company.address}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>연락처</label>
              <input
                type="text"
                name="company.contact_number"
                value={formData.company.contact_number}
                onChange={handleChange}
                required
              />
            </div>
          </div>
          
          <div className="form-step">
            <h3>4단계: 관리자 정보 입력</h3>
            <div className="form-group">
              <label>아이디</label>
              <input
                type="text"
                name="admin.username"
                value={formData.admin.username}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>비밀번호</label>
              <input
                type="password"
                name="admin.password"
                value={formData.admin.password}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>이메일</label>
              <input
                type="email"
                name="admin.email"
                value={formData.admin.email}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>담당자명</label>
              <input
                type="text"
                name="admin.contact_name"
                value={formData.admin.contact_name}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>연락처</label>
              <input
                type="text"
                name="admin.contact_phone"
                value={formData.admin.contact_phone}
                onChange={handleChange}
                required
              />
            </div>
          </div>
          
          <button type="submit">회원가입</button>
        </form>
        
        <div className="signup-links">
          <a href="/login">이미 계정이 있으신가요? 로그인</a>
        </div>
      </div>
    </div>
  );
};

export default SignupPage;
```

#### 6.3.3 대시보드 페이지
```javascript
// pages/DashboardPage.js
import { useEffect, useState } from 'react';
import { useSelector } from 'react-redux';
import ExcelDownload from '../components/ExcelDownload';
import SettlementSummary from '../components/SettlementSummary';
import OrderSummary from '../components/OrderSummary';
import RebateSummary from '../components/RebateSummary';

const DashboardPage = () => {
  const { user } = useSelector(state => state.auth);
  const [dashboardData, setDashboardData] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    fetchDashboardData();
  }, []);
  
  const fetchDashboardData = async () => {
    try {
      const response = await fetch('/api/statistics/dashboard/');
      const data = await response.json();
      setDashboardData(data);
    } catch (error) {
      console.error('대시보드 데이터 로드 실패:', error);
    } finally {
      setLoading(false);
    }
  };
  
  if (loading) {
    return <div className="loading">로딩 중...</div>;
  }
  
  return (
    <div className="dashboard-page">
      <h1>대시보드</h1>
      
      <div className="dashboard-grid">
        <div className="dashboard-card">
          <h3>주문 현황</h3>
          <OrderSummary data={dashboardData?.orders} />
        </div>
        
        <div className="dashboard-card">
          <h3>리베이트 현황</h3>
          <RebateSummary data={dashboardData?.rebates} />
        </div>
        
        <div className="dashboard-card">
          <h3>정산 현황</h3>
          <SettlementSummary data={dashboardData?.settlements} />
        </div>
        
        <div className="dashboard-card">
          <h3>최근 활동</h3>
          <div className="recent-activities">
            {dashboardData?.recent_activities?.map((activity, index) => (
              <div key={index} className="activity-item">
                <span className="activity-time">
                  {new Date(activity.timestamp).toLocaleString()}
                </span>
                <span className="activity-message">{activity.message}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
      
      <div className="dashboard-actions">
        <ExcelDownload companyType={user?.company_type} />
      </div>
    </div>
  );
};

export default DashboardPage;
```

### 6.4 Redux 상태 관리

#### 6.4.1 인증 상태 관리
```javascript
// features/auth/authSlice.js
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { loginApi, logoutApi, refreshApi } from '../../services/api';

// Async thunks
export const login = createAsyncThunk(
  'auth/login',
  async (credentials, { rejectWithValue }) => {
    try {
      const response = await loginApi(credentials);
      return response;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || '로그인에 실패했습니다.');
    }
  }
);

export const logout = createAsyncThunk(
  'auth/logout',
  async (_, { rejectWithValue }) => {
    try {
      await logoutApi();
      return null;
    } catch (error) {
      return rejectWithValue('로그아웃에 실패했습니다.');
    }
  }
);

export const refreshToken = createAsyncThunk(
  'auth/refreshToken',
  async (_, { rejectWithValue }) => {
    try {
      const response = await refreshApi();
      return response;
    } catch (error) {
      return rejectWithValue('토큰 갱신에 실패했습니다.');
    }
  }
);

const getInitialState = () => {
  const accessToken = localStorage.getItem('accessToken');
  const user = JSON.parse(localStorage.getItem('user') || 'null');
  
  return {
    isAuthenticated: !!accessToken,
    accessToken,
    refreshToken: localStorage.getItem('refreshToken'),
    user,
    loading: false,
    error: null
  };
};

const authSlice = createSlice({
  name: 'auth',
  initialState: getInitialState(),
  reducers: {
    clearError: (state) => {
      state.error = null;
    },
    updateUser: (state, action) => {
      state.user = { ...state.user, ...action.payload };
      localStorage.setItem('user', JSON.stringify(state.user));
    }
  },
  extraReducers: (builder) => {
    builder
      // Login
      .addCase(login.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(login.fulfilled, (state, action) => {
        state.loading = false;
        state.isAuthenticated = true;
        state.accessToken = action.payload.access;
        state.refreshToken = action.payload.refresh;
        state.user = action.payload.user_info;
        
        localStorage.setItem('accessToken', action.payload.access);
        localStorage.setItem('refreshToken', action.payload.refresh);
        localStorage.setItem('user', JSON.stringify(action.payload.user_info));
      })
      .addCase(login.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      
      // Logout
      .addCase(logout.fulfilled, (state) => {
        state.isAuthenticated = false;
        state.accessToken = null;
        state.refreshToken = null;
        state.user = null;
        
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        localStorage.removeItem('user');
      })
      
      // Refresh Token
      .addCase(refreshToken.fulfilled, (state, action) => {
        state.accessToken = action.payload.access;
        localStorage.setItem('accessToken', action.payload.access);
      })
      .addCase(refreshToken.rejected, (state) => {
        state.isAuthenticated = false;
        state.accessToken = null;
        state.refreshToken = null;
        state.user = null;
        
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        localStorage.removeItem('user');
      });
  }
});

export const { clearError, updateUser } = authSlice.actions;
export default authSlice.reducer;
```

#### 6.4.2 정책 상태 관리
```javascript
// features/policies/policySlice.js
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { 
  fetchPoliciesApi, 
  createPolicyApi, 
  updatePolicyApi, 
  deletePolicyApi 
} from '../../services/api';

export const fetchPolicies = createAsyncThunk(
  'policies/fetchPolicies',
  async (_, { rejectWithValue }) => {
    try {
      const response = await fetchPoliciesApi();
      return response;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || '정책 목록을 불러오는데 실패했습니다.');
    }
  }
);

export const createPolicy = createAsyncThunk(
  'policies/createPolicy',
  async (policyData, { rejectWithValue }) => {
    try {
      const response = await createPolicyApi(policyData);
      return response;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || '정책 생성에 실패했습니다.');
    }
  }
);

export const updatePolicy = createAsyncThunk(
  'policies/updatePolicy',
  async ({ id, policyData }, { rejectWithValue }) => {
    try {
      const response = await updatePolicyApi(id, policyData);
      return response;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || '정책 수정에 실패했습니다.');
    }
  }
);

export const deletePolicy = createAsyncThunk(
  'policies/deletePolicy',
  async (id, { rejectWithValue }) => {
    try {
      await deletePolicyApi(id);
      return id;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || '정책 삭제에 실패했습니다.');
    }
  }
);

const policySlice = createSlice({
  name: 'policies',
  initialState: {
    policies: [],
    currentPolicy: null,
    loading: false,
    error: null
  },
  reducers: {
    clearError: (state) => {
      state.error = null;
    },
    clearCurrentPolicy: (state) => {
      state.currentPolicy = null;
    },
    setLoading: (state, action) => {
      state.loading = action.payload;
    }
  },
  extraReducers: (builder) => {
    builder
      // Fetch Policies
      .addCase(fetchPolicies.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchPolicies.fulfilled, (state, action) => {
        state.loading = false;
        state.policies = action.payload.results;
      })
      .addCase(fetchPolicies.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      
      // Create Policy
      .addCase(createPolicy.fulfilled, (state, action) => {
        state.policies.push(action.payload);
      })
      
      // Update Policy
      .addCase(updatePolicy.fulfilled, (state, action) => {
        const index = state.policies.findIndex(p => p.id === action.payload.id);
        if (index !== -1) {
          state.policies[index] = action.payload;
        }
      })
      
      // Delete Policy
      .addCase(deletePolicy.fulfilled, (state, action) => {
        state.policies = state.policies.filter(p => p.id !== action.payload);
      });
  }
});

export const { clearError, clearCurrentPolicy, setLoading } = policySlice.actions;
export default policySlice.reducer;
```

### 6.5 API 서비스

#### 6.5.1 API 서비스 구조
```javascript
// services/api.js
import axios from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:8000';

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('accessToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Response interceptor
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;
    
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      
      try {
        const refreshToken = localStorage.getItem('refreshToken');
        const response = await api.post('/api/auth/refresh/', {
          refresh: refreshToken
        });
        
        localStorage.setItem('accessToken', response.data.access);
        originalRequest.headers.Authorization = `Bearer ${response.data.access}`;
        
        return api(originalRequest);
      } catch (refreshError) {
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        localStorage.removeItem('user');
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }
    
    return Promise.reject(error);
  }
);

// Auth API
export const loginApi = (credentials) => api.post('/api/auth/login/', credentials);
export const logoutApi = () => api.post('/api/auth/logout/');
export const refreshApi = () => api.post('/api/auth/refresh/');
export const signupApi = (userData) => api.post('/api/companies/signup/', userData);

// Company API
export const fetchCompaniesApi = (params) => api.get('/api/companies/', { params });
export const createCompanyApi = (companyData) => api.post('/api/companies/', companyData);
export const updateCompanyApi = (id, companyData) => api.put(`/api/companies/${id}/`, companyData);
export const deleteCompanyApi = (id) => api.delete(`/api/companies/${id}/`);

// Policy API
export const fetchPoliciesApi = (params) => api.get('/api/policies/', { params });
export const createPolicyApi = (policyData) => api.post('/api/policies/', policyData);
export const updatePolicyApi = (id, policyData) => api.put(`/api/policies/${id}/`, policyData);
export const deletePolicyApi = (id) => api.delete(`/api/policies/${id}/`);

// Order API
export const fetchOrdersApi = (params) => api.get('/api/orders/', { params });
export const createOrderApi = (orderData) => api.post('/api/orders/', orderData);
export const updateOrderApi = (id, orderData) => api.put(`/api/orders/${id}/`, orderData);
export const deleteOrderApi = (id) => api.delete(`/api/orders/${id}/`);

// Rebate API
export const fetchRebatesApi = (params) => api.get('/api/rebates/allocations/', { params });
export const createRebateApi = (rebateData) => api.post('/api/rebates/allocations/', rebateData);
export const updateRebateApi = (id, rebateData) => api.put(`/api/rebates/allocations/${id}/`, rebateData);

// Excel Download API
export const downloadExcel = async (type, startDate, endDate) => {
  const response = await api.get(`/api/${type}/excel/`, {
    params: { start_date: startDate, end_date: endDate },
    responseType: 'blob'
  });
  
  const url = window.URL.createObjectURL(new Blob([response.data]));
  const link = document.createElement('a');
  link.href = url;
  link.setAttribute('download', `${type}_${new Date().toISOString().split('T')[0]}.xlsx`);
  document.body.appendChild(link);
  link.click();
  link.remove();
};

export default api;
```

### 6.6 유틸리티 함수

#### 6.6.1 권한 관리 유틸리티
```javascript
// utils/permissions.js
export const checkPermission = (user, permission) => {
  if (!user) return false;
  
  const userPermissions = user.permissions || [];
  return userPermissions.includes(permission);
};

export const checkCompanyPermission = (user, companyId, action) => {
  if (!user) return false;
  
  // 본사는 모든 권한
  if (user.company_type === 'headquarters') {
    return true;
  }
  
  // 협력사는 하위 업체만 접근 가능
  if (user.company_type === 'agency') {
    return user.company_id === companyId || 
           user.subordinate_companies?.includes(companyId);
  }
  
  // 판매점은 본인만 접근 가능
  if (user.company_type === 'retail') {
    return user.company_id === companyId;
  }
  
  return false;
};

export const getAccessibleCompanies = (user) => {
  if (!user) return [];
  
  if (user.company_type === 'headquarters') {
    return user.all_companies || [];
  }
  
  if (user.company_type === 'agency') {
    return [user.parent_company, ...(user.subordinate_companies || [])];
  }
  
  if (user.company_type === 'retail') {
    return [user.parent_company];
  }
  
  return [];
};
```

#### 6.6.2 데이터 포맷팅 유틸리티
```javascript
// utils/formatters.js
export const formatCurrency = (amount) => {
  return new Intl.NumberFormat('ko-KR', {
    style: 'currency',
    currency: 'KRW'
  }).format(amount);
};

export const formatDate = (date) => {
  return new Date(date).toLocaleDateString('ko-KR');
};

export const formatDateTime = (date) => {
  return new Date(date).toLocaleString('ko-KR');
};

export const formatPhoneNumber = (phone) => {
  if (!phone) return '';
  
  const cleaned = phone.replace(/\D/g, '');
  const match = cleaned.match(/^(\d{3})(\d{4})(\d{4})$/);
  
  if (match) {
    return `${match[1]}-${match[2]}-${match[3]}`;
  }
  
  return phone;
};

export const formatBusinessNumber = (number) => {
  if (!number) return '';
  
  const cleaned = number.replace(/\D/g, '');
  const match = cleaned.match(/^(\d{3})(\d{2})(\d{5})$/);
  
  if (match) {
    return `${match[1]}-${match[2]}-${match[3]}`;
  }
  
  return number;
};

export const formatStatus = (status) => {
  const statusMap = {
    pending: '대기중',
    approved: '승인됨',
    rejected: '거부됨',
    shipped: '발송됨',
    completed: '완료됨'
  };
  
  return statusMap[status] || status;
};

export const getStatusColor = (status) => {
  const colorMap = {
    pending: '#ff9800',
    approved: '#4caf50',
    rejected: '#f44336',
    shipped: '#2196f3',
    completed: '#4caf50'
  };
  
  return colorMap[status] || '#757575';
};
```

### 6.7 스타일링

#### 6.7.1 CSS 구조
```css
/* App.css */
.app {
  display: flex;
  min-height: 100vh;
}

.main-content {
  flex: 1;
  padding: 20px;
  background-color: #f5f5f5;
}

/* Sidebar.css */
.sidebar {
  width: 250px;
  background-color: #2c3e50;
  color: white;
  display: flex;
  flex-direction: column;
}

.sidebar-header {
  padding: 20px;
  border-bottom: 1px solid #34495e;
}

.sidebar-nav {
  flex: 1;
  padding: 20px 0;
}

.nav-item {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  color: white;
  text-decoration: none;
  transition: background-color 0.3s;
}

.nav-item:hover {
  background-color: #34495e;
}

.nav-item.active {
  background-color: #3498db;
}

/* Dashboard.css */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.dashboard-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Form.css */
.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: 500;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: #3498db;
  box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

/* Button.css */
.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.btn-primary {
  background-color: #3498db;
  color: white;
}

.btn-primary:hover {
  background-color: #2980b9;
}

.btn-success {
  background-color: #27ae60;
  color: white;
}

.btn-success:hover {
  background-color: #229954;
}

.btn-danger {
  background-color: #e74c3c;
  color: white;
}

.btn-danger:hover {
  background-color: #c0392b;
}
```

이 프론트엔드 구조는 React와 Redux를 기반으로 한 모던한 웹 애플리케이션의 구조를 제공합니다.
