# 6. í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°

## ğŸ¨ DN_SOLUTION2 í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°

### 6.1 í˜ì´ì§€ êµ¬ì¡°

#### 6.1.1 ì „ì²´ í˜ì´ì§€ êµ¬ì¡°
```
/login - ë¡œê·¸ì¸
/signup - í†µí•© íšŒì›ê°€ì…
/forgot-password - ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
/dashboard - ë©”ì¸ ëŒ€ì‹œë³´ë“œ
/statistics - í†µê³„ í˜ì´ì§€
/companies - ì—…ì²´ ëª©ë¡
/companies/create - ì—…ì²´ ìƒì„±
/companies/{id} - ì—…ì²´ ìƒì„¸
/companies/{id}/edit - ì—…ì²´ ìˆ˜ì •
/policies - ì •ì±… ëª©ë¡
/policies/create - ì •ì±… ìƒì„± (ë‹¨ê³„ë³„)
/policies/{id} - ì •ì±… ìƒì„¸
/policies/{id}/edit - ì •ì±… ìˆ˜ì •
/orders - ì£¼ë¬¸ ëª©ë¡
/orders/create - ì£¼ë¬¸ ìƒì„±
/orders/{id} - ì£¼ë¬¸ ìƒì„¸
/orders/{id}/edit - ì£¼ë¬¸ ìˆ˜ì •
/rebates - ë¦¬ë² ì´íŠ¸ ê´€ë¦¬
/rebates/allocations - í• ë‹¹ ê´€ë¦¬
/rebates/settlements - ì •ì‚° ê´€ë¦¬
/product-prices - ìƒí’ˆ ê°€ê²© ê´€ë¦¬
/product-prices/create - ìƒí’ˆ ê°€ê²© ì¶”ê°€
/product-prices/{id}/edit - ìƒí’ˆ ê°€ê²© ìˆ˜ì •
```

#### 6.1.2 ë¼ìš°íŒ… êµ¬ì¡°
```javascript
// App.js
import { BrowserRouter as Router, Routes, Route } from 'react-router-dom';

function App() {
  return (
    <Router>
      <Routes>
        {/* ê³µê°œ í˜ì´ì§€ */}
        <Route path="/login" element={<LoginPage />} />
        <Route path="/signup" element={<SignupPage />} />
        <Route path="/forgot-password" element={<ForgotPasswordPage />} />
        
        {/* ë³´í˜¸ëœ í˜ì´ì§€ */}
        <Route path="/" element={<ProtectedRoute><MainLayout /></ProtectedRoute>}>
          <Route index element={<DashboardPage />} />
          <Route path="dashboard" element={<DashboardPage />} />
          <Route path="statistics" element={<StatisticsPage />} />
          
          {/* ì—…ì²´ ê´€ë¦¬ */}
          <Route path="companies" element={<CompanyListPage />} />
          <Route path="companies/create" element={<CompanyCreatePage />} />
          <Route path="companies/:id" element={<CompanyDetailPage />} />
          <Route path="companies/:id/edit" element={<CompanyEditPage />} />
          
          {/* ì •ì±… ê´€ë¦¬ */}
          <Route path="policies" element={<PolicyListPage />} />
          <Route path="policies/create" element={<PolicyCreatePage />} />
          <Route path="policies/:id" element={<PolicyDetailPage />} />
          <Route path="policies/:id/edit" element={<PolicyEditPage />} />
          
          {/* ì£¼ë¬¸ ê´€ë¦¬ */}
          <Route path="orders" element={<OrderListPage />} />
          <Route path="orders/create" element={<OrderCreatePage />} />
          <Route path="orders/:id" element={<OrderDetailPage />} />
          <Route path="orders/:id/edit" element={<OrderEditPage />} />
          
          {/* ë¦¬ë² ì´íŠ¸ ê´€ë¦¬ */}
          <Route path="rebates" element={<RebatePage />} />
          <Route path="rebates/allocations" element={<RebateAllocationPage />} />
          <Route path="rebates/settlements" element={<RebateSettlementPage />} />
          
          {/* ìƒí’ˆ ê°€ê²© ê´€ë¦¬ */}
          <Route path="product-prices" element={<ProductPriceListPage />} />
          <Route path="product-prices/create" element={<ProductPriceCreatePage />} />
          <Route path="product-prices/:id/edit" element={<ProductPriceEditPage />} />
        </Route>
      </Routes>
    </Router>
  );
}
```

### 6.2 ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

#### 6.2.1 ì „ì²´ ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°
```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ProtectedRoute.js - ê¶Œí•œ ê¸°ë°˜ ë¼ìš°íŠ¸
â”‚   â”œâ”€â”€ Sidebar.js - ì‚¬ì´ë“œë°”
â”‚   â”œâ”€â”€ ExcelDownload.js - ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
â”‚   â”œâ”€â”€ SettlementSummary.js - ì •ì‚° ìš”ì•½
â”‚   â”œâ”€â”€ OrderSummary.js - ì£¼ë¬¸ ìš”ì•½
â”‚   â”œâ”€â”€ RebateSummary.js - ë¦¬ë² ì´íŠ¸ ìš”ì•½
â”‚   â””â”€â”€ HierarchicalSettlement.js - ê³„ì¸µë³„ ì •ì‚°
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ LoginPage.js - ë¡œê·¸ì¸
â”‚   â”œâ”€â”€ SignupPage.js - íšŒì›ê°€ì…
â”‚   â”œâ”€â”€ DashboardPage.js - ëŒ€ì‹œë³´ë“œ
â”‚   â”œâ”€â”€ CompanyListPage.js - ì—…ì²´ ëª©ë¡
â”‚   â”œâ”€â”€ PolicyListPage.js - ì •ì±… ëª©ë¡
â”‚   â”œâ”€â”€ OrderListPage.js - ì£¼ë¬¸ ëª©ë¡
â”‚   â””â”€â”€ RebatePage.js - ë¦¬ë² ì´íŠ¸ ê´€ë¦¬
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ authSlice.js - ì¸ì¦ ìƒíƒœ ê´€ë¦¬
â”‚   â”œâ”€â”€ policies/
â”‚   â”‚   â””â”€â”€ policySlice.js - ì •ì±… ìƒíƒœ ê´€ë¦¬
â”‚   â””â”€â”€ orders/
â”‚       â””â”€â”€ orderSlice.js - ì£¼ë¬¸ ìƒíƒœ ê´€ë¦¬
â”œâ”€â”€ services/
â”‚   â””â”€â”€ api.js - API í†µì‹ 
â””â”€â”€ utils/
    â”œâ”€â”€ permissions.js - ê¶Œí•œ ê´€ë¦¬
    â””â”€â”€ formatters.js - ë°ì´í„° í¬ë§·íŒ…
```

#### 6.2.2 ê³µí†µ ì»´í¬ë„ŒíŠ¸

##### 6.2.2.1 ProtectedRoute ì»´í¬ë„ŒíŠ¸
```javascript
// components/ProtectedRoute.js
import { useSelector } from 'react-redux';
import { Navigate } from 'react-router-dom';

const ProtectedRoute = ({ children, requiredPermissions = [] }) => {
  const { isAuthenticated, user } = useSelector(state => state.auth);
  
  if (!isAuthenticated) {
    return <Navigate to="/login" replace />;
  }
  
  if (requiredPermissions.length > 0) {
    const hasPermission = requiredPermissions.every(permission => 
      user.permissions.includes(permission)
    );
    
    if (!hasPermission) {
      return <Navigate to="/dashboard" replace />;
    }
  }
  
  return children;
};

export default ProtectedRoute;
```

##### 6.2.2.2 Sidebar ì»´í¬ë„ŒíŠ¸
```javascript
// components/Sidebar.js
import { useSelector, useDispatch } from 'react-redux';
import { logout } from '../features/auth/authSlice';

const Sidebar = () => {
  const dispatch = useDispatch();
  const { user } = useSelector(state => state.auth);
  
  const menuItems = [
    {
      title: 'ëŒ€ì‹œë³´ë“œ',
      path: '/dashboard',
      icon: 'dashboard',
      permission: 'dashboard'
    },
    {
      title: 'ì—…ì²´ ê´€ë¦¬',
      path: '/companies',
      icon: 'business',
      permission: 'company_read'
    },
    {
      title: 'ì •ì±… ê´€ë¦¬',
      path: '/policies',
      icon: 'policy',
      permission: 'policy_read'
    },
    {
      title: 'ì£¼ë¬¸ ê´€ë¦¬',
      path: '/orders',
      icon: 'order',
      permission: 'order_read'
    },
    {
      title: 'ë¦¬ë² ì´íŠ¸ ê´€ë¦¬',
      path: '/rebates',
      icon: 'money',
      permission: 'rebate_read'
    },
    {
      title: 'ìƒí’ˆ ê°€ê²©',
      path: '/product-prices',
      icon: 'price',
      permission: 'product_price_read'
    }
  ];
  
  const handleLogout = () => {
    dispatch(logout());
  };
  
  return (
    <div className="sidebar">
      <div className="sidebar-header">
        <h2>DN_SOLUTION2</h2>
      </div>
      
      <nav className="sidebar-nav">
        {menuItems.map(item => (
          <PermissionGuard key={item.path} permission={item.permission}>
            <NavLink to={item.path} className="nav-item">
              <i className={`icon-${item.icon}`}></i>
              <span>{item.title}</span>
            </NavLink>
          </PermissionGuard>
        ))}
      </nav>
      
      <div className="sidebar-footer">
        <div className="user-info">
          <span className="username">{user?.username || 'ì‚¬ìš©ì'}</span>
          <span className="role">{user?.role || 'ì—­í• '}</span>
          {user?.email && (
            <span className="email">{user.email}</span>
          )}
        </div>
        <button className="logout-btn" onClick={handleLogout}>
          ë¡œê·¸ì•„ì›ƒ
        </button>
      </div>
    </div>
  );
};

export default Sidebar;
```

##### 6.2.2.3 ExcelDownload ì»´í¬ë„ŒíŠ¸
```javascript
// components/ExcelDownload.js
import { useState } from 'react';
import { downloadExcel } from '../services/api';

const ExcelDownload = ({ companyType }) => {
  const [startDate, setStartDate] = useState('');
  const [endDate, setEndDate] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  
  const handleDownload = async (type) => {
    if (!startDate || !endDate) {
      alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
      return;
    }
    
    setIsLoading(true);
    try {
      await downloadExcel(type, startDate, endDate);
    } catch (error) {
      console.error('ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:', error);
      alert('ì—‘ì…€ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsLoading(false);
    }
  };
  
  return (
    <div className="excel-download">
      <h3>ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</h3>
      
      <div className="date-range">
        <div className="date-input">
          <label>ì‹œì‘ì¼:</label>
          <input
            type="date"
            value={startDate}
            onChange={(e) => setStartDate(e.target.value)}
          />
        </div>
        <div className="date-input">
          <label>ì¢…ë£Œì¼:</label>
          <input
            type="date"
            value={endDate}
            onChange={(e) => setEndDate(e.target.value)}
          />
        </div>
      </div>
      
      <div className="download-buttons">
        <button
          onClick={() => handleDownload('settlements')}
          disabled={isLoading}
        >
          ì •ì‚° ìƒì„¸ ë‚´ì—­ ë‹¤ìš´ë¡œë“œ
        </button>
        
        {companyType === 'headquarters' && (
          <button
            onClick={() => handleDownload('hierarchical')}
            disabled={isLoading}
          >
            ê³„ì¸µë³„ ì •ì‚° ë‚´ì—­ ë‹¤ìš´ë¡œë“œ
          </button>
        )}
        
        <button
          onClick={() => handleDownload('orders')}
          disabled={isLoading}
        >
          ì£¼ë¬¸ ë‚´ì—­ ë‹¤ìš´ë¡œë“œ
        </button>
        
        <button
          onClick={() => handleDownload('rebates')}
          disabled={isLoading}
        >
          ë¦¬ë² ì´íŠ¸ ë‚´ì—­ ë‹¤ìš´ë¡œë“œ
        </button>
      </div>
      
      {isLoading && <div className="loading">ë‹¤ìš´ë¡œë“œ ì¤‘...</div>}
    </div>
  );
};

export default ExcelDownload;
```

### 6.3 í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸

#### 6.3.1 ë¡œê·¸ì¸ í˜ì´ì§€
```javascript
// pages/LoginPage.js
import { useState } from 'react';
import { useDispatch, useSelector } from 'react-redux';
import { useNavigate } from 'react-router-dom';
import { login } from '../features/auth/authSlice';

const LoginPage = () => {
  const dispatch = useDispatch();
  const navigate = useNavigate();
  const { loading, error } = useSelector(state => state.auth);
  
  const [formData, setFormData] = useState({
    username: '',
    password: ''
  });
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    try {
      await dispatch(login(formData)).unwrap();
      navigate('/dashboard');
    } catch (error) {
      console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
    }
  };
  
  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };
  
  return (
    <div className="login-page">
      <div className="login-container">
        <h1>DN_SOLUTION2</h1>
        <h2>ë¡œê·¸ì¸</h2>
        
        <form onSubmit={handleSubmit}>
          <div className="form-group">
            <label>ì•„ì´ë””</label>
            <input
              type="text"
              name="username"
              value={formData.username}
              onChange={handleChange}
              required
            />
          </div>
          
          <div className="form-group">
            <label>ë¹„ë°€ë²ˆí˜¸</label>
            <input
              type="password"
              name="password"
              value={formData.password}
              onChange={handleChange}
              required
            />
          </div>
          
          {error && <div className="error-message">{error}</div>}
          
          <button type="submit" disabled={loading}>
            {loading ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸'}
          </button>
        </form>
        
        <div className="login-links">
          <a href="/signup">íšŒì›ê°€ì…</a>
          <a href="/forgot-password">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
        </div>
      </div>
    </div>
  );
};

export default LoginPage;
```

#### 6.3.2 íšŒì›ê°€ì… í˜ì´ì§€
```javascript
// pages/SignupPage.js
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { signup } from '../services/api';

const SignupPage = () => {
  const navigate = useNavigate();
  const [step, setStep] = useState(1);
  const [formData, setFormData] = useState({
    user_type: '',
    parent_company_code: '',
    company: {
      name: '',
      business_number: '',
      address: '',
      contact_number: ''
    },
    admin: {
      username: '',
      password: '',
      email: '',
      contact_name: '',
      contact_phone: ''
    }
  });
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    
    try {
      const response = await signup(formData);
      alert(`íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì—…ì²´ì½”ë“œ: ${response.company_code}`);
      navigate('/login');
    } catch (error) {
      console.error('íšŒì›ê°€ì… ì‹¤íŒ¨:', error);
      alert('íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };
  
  const handleChange = (e) => {
    const { name, value } = e.target;
    
    if (name.includes('.')) {
      const [section, field] = name.split('.');
      setFormData({
        ...formData,
        [section]: {
          ...formData[section],
          [field]: value
        }
      });
    } else {
      setFormData({
        ...formData,
        [name]: value
      });
    }
  };
  
  return (
    <div className="signup-page">
      <div className="signup-container">
        <h1>DN_SOLUTION2</h1>
        <h2>íšŒì›ê°€ì…</h2>
        
        <form onSubmit={handleSubmit}>
          <div className="form-step">
            <h3>1ë‹¨ê³„: íšŒì› ìœ í˜• ì„ íƒ</h3>
            <div className="form-group">
              <label>íšŒì› ìœ í˜•</label>
              <select
                name="user_type"
                value={formData.user_type}
                onChange={handleChange}
                required
              >
                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                <option value="headquarters">ë³¸ì‚¬ ê´€ë¦¬ì</option>
                <option value="agency">í˜‘ë ¥ì‚¬ ê´€ë¦¬ì</option>
                <option value="retail">íŒë§¤ì  ì§ì›</option>
              </select>
            </div>
          </div>
          
          {formData.user_type !== 'headquarters' && (
            <div className="form-step">
              <h3>2ë‹¨ê³„: ìƒìœ„ ì—…ì²´ì½”ë“œ ì…ë ¥</h3>
              <div className="form-group">
                <label>ìƒìœ„ ì—…ì²´ì½”ë“œ</label>
                <input
                  type="text"
                  name="parent_company_code"
                  value={formData.parent_company_code}
                  onChange={handleChange}
                  required
                  placeholder="ìƒìœ„ ì—…ì²´ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                />
              </div>
            </div>
          )}
          
          <div className="form-step">
            <h3>3ë‹¨ê³„: ì—…ì²´ ì •ë³´ ì…ë ¥</h3>
            <div className="form-group">
              <label>ì—…ì²´ëª…</label>
              <input
                type="text"
                name="company.name"
                value={formData.company.name}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸</label>
              <input
                type="text"
                name="company.business_number"
                value={formData.company.business_number}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>ì£¼ì†Œ</label>
              <input
                type="text"
                name="company.address"
                value={formData.company.address}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>ì—°ë½ì²˜</label>
              <input
                type="text"
                name="company.contact_number"
                value={formData.company.contact_number}
                onChange={handleChange}
                required
              />
            </div>
          </div>
          
          <div className="form-step">
            <h3>4ë‹¨ê³„: ê´€ë¦¬ì ì •ë³´ ì…ë ¥</h3>
            <div className="form-group">
              <label>ì•„ì´ë””</label>
              <input
                type="text"
                name="admin.username"
                value={formData.admin.username}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>ë¹„ë°€ë²ˆí˜¸</label>
              <input
                type="password"
                name="admin.password"
                value={formData.admin.password}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>ì´ë©”ì¼</label>
              <input
                type="email"
                name="admin.email"
                value={formData.admin.email}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>ë‹´ë‹¹ìëª…</label>
              <input
                type="text"
                name="admin.contact_name"
                value={formData.admin.contact_name}
                onChange={handleChange}
                required
              />
            </div>
            <div className="form-group">
              <label>ì—°ë½ì²˜</label>
              <input
                type="text"
                name="admin.contact_phone"
                value={formData.admin.contact_phone}
                onChange={handleChange}
                required
              />
            </div>
          </div>
          
          <button type="submit">íšŒì›ê°€ì…</button>
        </form>
        
        <div className="signup-links">
          <a href="/login">ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸</a>
        </div>
      </div>
    </div>
  );
};

export default SignupPage;
```

#### 6.3.3 ëŒ€ì‹œë³´ë“œ í˜ì´ì§€
```javascript
// pages/DashboardPage.js
import { useEffect, useState } from 'react';
import { useSelector } from 'react-redux';
import ExcelDownload from '../components/ExcelDownload';
import SettlementSummary from '../components/SettlementSummary';
import OrderSummary from '../components/OrderSummary';
import RebateSummary from '../components/RebateSummary';

const DashboardPage = () => {
  const { user } = useSelector(state => state.auth);
  const [dashboardData, setDashboardData] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    fetchDashboardData();
  }, []);
  
  const fetchDashboardData = async () => {
    try {
      const response = await fetch('/api/statistics/dashboard/');
      const data = await response.json();
      setDashboardData(data);
    } catch (error) {
      console.error('ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
    } finally {
      setLoading(false);
    }
  };
  
  if (loading) {
    return <div className="loading">ë¡œë”© ì¤‘...</div>;
  }
  
  return (
    <div className="dashboard-page">
      <h1>ëŒ€ì‹œë³´ë“œ</h1>
      
      <div className="dashboard-grid">
        <div className="dashboard-card">
          <h3>ì£¼ë¬¸ í˜„í™©</h3>
          <OrderSummary data={dashboardData?.orders} />
        </div>
        
        <div className="dashboard-card">
          <h3>ë¦¬ë² ì´íŠ¸ í˜„í™©</h3>
          <RebateSummary data={dashboardData?.rebates} />
        </div>
        
        <div className="dashboard-card">
          <h3>ì •ì‚° í˜„í™©</h3>
          <SettlementSummary data={dashboardData?.settlements} />
        </div>
        
        <div className="dashboard-card">
          <h3>ìµœê·¼ í™œë™</h3>
          <div className="recent-activities">
            {dashboardData?.recent_activities?.map((activity, index) => (
              <div key={index} className="activity-item">
                <span className="activity-time">
                  {new Date(activity.timestamp).toLocaleString()}
                </span>
                <span className="activity-message">{activity.message}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
      
      <div className="dashboard-actions">
        <ExcelDownload companyType={user?.company_type} />
      </div>
    </div>
  );
};

export default DashboardPage;
```

### 6.4 Redux ìƒíƒœ ê´€ë¦¬

#### 6.4.1 ì¸ì¦ ìƒíƒœ ê´€ë¦¬
```javascript
// features/auth/authSlice.js
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { loginApi, logoutApi, refreshApi } from '../../services/api';

// Async thunks
export const login = createAsyncThunk(
  'auth/login',
  async (credentials, { rejectWithValue }) => {
    try {
      const response = await loginApi(credentials);
      return response;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  }
);

export const logout = createAsyncThunk(
  'auth/logout',
  async (_, { rejectWithValue }) => {
    try {
      await logoutApi();
      return null;
    } catch (error) {
      return rejectWithValue('ë¡œê·¸ì•„ì›ƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  }
);

export const refreshToken = createAsyncThunk(
  'auth/refreshToken',
  async (_, { rejectWithValue }) => {
    try {
      const response = await refreshApi();
      return response;
    } catch (error) {
      return rejectWithValue('í† í° ê°±ì‹ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  }
);

const getInitialState = () => {
  const accessToken = localStorage.getItem('accessToken');
  const user = JSON.parse(localStorage.getItem('user') || 'null');
  
  return {
    isAuthenticated: !!accessToken,
    accessToken,
    refreshToken: localStorage.getItem('refreshToken'),
    user,
    loading: false,
    error: null
  };
};

const authSlice = createSlice({
  name: 'auth',
  initialState: getInitialState(),
  reducers: {
    clearError: (state) => {
      state.error = null;
    },
    updateUser: (state, action) => {
      state.user = { ...state.user, ...action.payload };
      localStorage.setItem('user', JSON.stringify(state.user));
    }
  },
  extraReducers: (builder) => {
    builder
      // Login
      .addCase(login.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(login.fulfilled, (state, action) => {
        state.loading = false;
        state.isAuthenticated = true;
        state.accessToken = action.payload.access;
        state.refreshToken = action.payload.refresh;
        state.user = action.payload.user_info;
        
        localStorage.setItem('accessToken', action.payload.access);
        localStorage.setItem('refreshToken', action.payload.refresh);
        localStorage.setItem('user', JSON.stringify(action.payload.user_info));
      })
      .addCase(login.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      
      // Logout
      .addCase(logout.fulfilled, (state) => {
        state.isAuthenticated = false;
        state.accessToken = null;
        state.refreshToken = null;
        state.user = null;
        
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        localStorage.removeItem('user');
      })
      
      // Refresh Token
      .addCase(refreshToken.fulfilled, (state, action) => {
        state.accessToken = action.payload.access;
        localStorage.setItem('accessToken', action.payload.access);
      })
      .addCase(refreshToken.rejected, (state) => {
        state.isAuthenticated = false;
        state.accessToken = null;
        state.refreshToken = null;
        state.user = null;
        
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        localStorage.removeItem('user');
      });
  }
});

export const { clearError, updateUser } = authSlice.actions;
export default authSlice.reducer;
```

#### 6.4.2 ì •ì±… ìƒíƒœ ê´€ë¦¬
```javascript
// features/policies/policySlice.js
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import { 
  fetchPoliciesApi, 
  createPolicyApi, 
  updatePolicyApi, 
  deletePolicyApi 
} from '../../services/api';

export const fetchPolicies = createAsyncThunk(
  'policies/fetchPolicies',
  async (_, { rejectWithValue }) => {
    try {
      const response = await fetchPoliciesApi();
      return response;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'ì •ì±… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  }
);

export const createPolicy = createAsyncThunk(
  'policies/createPolicy',
  async (policyData, { rejectWithValue }) => {
    try {
      const response = await createPolicyApi(policyData);
      return response;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'ì •ì±… ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  }
);

export const updatePolicy = createAsyncThunk(
  'policies/updatePolicy',
  async ({ id, policyData }, { rejectWithValue }) => {
    try {
      const response = await updatePolicyApi(id, policyData);
      return response;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'ì •ì±… ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  }
);

export const deletePolicy = createAsyncThunk(
  'policies/deletePolicy',
  async (id, { rejectWithValue }) => {
    try {
      await deletePolicyApi(id);
      return id;
    } catch (error) {
      return rejectWithValue(error.response?.data?.message || 'ì •ì±… ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  }
);

const policySlice = createSlice({
  name: 'policies',
  initialState: {
    policies: [],
    currentPolicy: null,
    loading: false,
    error: null
  },
  reducers: {
    clearError: (state) => {
      state.error = null;
    },
    clearCurrentPolicy: (state) => {
      state.currentPolicy = null;
    },
    setLoading: (state, action) => {
      state.loading = action.payload;
    }
  },
  extraReducers: (builder) => {
    builder
      // Fetch Policies
      .addCase(fetchPolicies.pending, (state) => {
        state.loading = true;
        state.error = null;
      })
      .addCase(fetchPolicies.fulfilled, (state, action) => {
        state.loading = false;
        state.policies = action.payload.results;
      })
      .addCase(fetchPolicies.rejected, (state, action) => {
        state.loading = false;
        state.error = action.payload;
      })
      
      // Create Policy
      .addCase(createPolicy.fulfilled, (state, action) => {
        state.policies.push(action.payload);
      })
      
      // Update Policy
      .addCase(updatePolicy.fulfilled, (state, action) => {
        const index = state.policies.findIndex(p => p.id === action.payload.id);
        if (index !== -1) {
          state.policies[index] = action.payload;
        }
      })
      
      // Delete Policy
      .addCase(deletePolicy.fulfilled, (state, action) => {
        state.policies = state.policies.filter(p => p.id !== action.payload);
      });
  }
});

export const { clearError, clearCurrentPolicy, setLoading } = policySlice.actions;
export default policySlice.reducer;
```

### 6.5 API ì„œë¹„ìŠ¤

#### 6.5.1 API ì„œë¹„ìŠ¤ êµ¬ì¡°
```javascript
// services/api.js
import axios from 'axios';

const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:8000';

const api = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('accessToken');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Response interceptor
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;
    
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      
      try {
        const refreshToken = localStorage.getItem('refreshToken');
        const response = await api.post('/api/auth/refresh/', {
          refresh: refreshToken
        });
        
        localStorage.setItem('accessToken', response.data.access);
        originalRequest.headers.Authorization = `Bearer ${response.data.access}`;
        
        return api(originalRequest);
      } catch (refreshError) {
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');
        localStorage.removeItem('user');
        window.location.href = '/login';
        return Promise.reject(refreshError);
      }
    }
    
    return Promise.reject(error);
  }
);

// Auth API
export const loginApi = (credentials) => api.post('/api/auth/login/', credentials);
export const logoutApi = () => api.post('/api/auth/logout/');
export const refreshApi = () => api.post('/api/auth/refresh/');
export const signupApi = (userData) => api.post('/api/companies/signup/', userData);

// Company API
export const fetchCompaniesApi = (params) => api.get('/api/companies/', { params });
export const createCompanyApi = (companyData) => api.post('/api/companies/', companyData);
export const updateCompanyApi = (id, companyData) => api.put(`/api/companies/${id}/`, companyData);
export const deleteCompanyApi = (id) => api.delete(`/api/companies/${id}/`);

// Policy API
export const fetchPoliciesApi = (params) => api.get('/api/policies/', { params });
export const createPolicyApi = (policyData) => api.post('/api/policies/', policyData);
export const updatePolicyApi = (id, policyData) => api.put(`/api/policies/${id}/`, policyData);
export const deletePolicyApi = (id) => api.delete(`/api/policies/${id}/`);

// Order API
export const fetchOrdersApi = (params) => api.get('/api/orders/', { params });
export const createOrderApi = (orderData) => api.post('/api/orders/', orderData);
export const updateOrderApi = (id, orderData) => api.put(`/api/orders/${id}/`, orderData);
export const deleteOrderApi = (id) => api.delete(`/api/orders/${id}/`);

// Rebate API
export const fetchRebatesApi = (params) => api.get('/api/rebates/allocations/', { params });
export const createRebateApi = (rebateData) => api.post('/api/rebates/allocations/', rebateData);
export const updateRebateApi = (id, rebateData) => api.put(`/api/rebates/allocations/${id}/`, rebateData);

// Excel Download API
export const downloadExcel = async (type, startDate, endDate) => {
  const response = await api.get(`/api/${type}/excel/`, {
    params: { start_date: startDate, end_date: endDate },
    responseType: 'blob'
  });
  
  const url = window.URL.createObjectURL(new Blob([response.data]));
  const link = document.createElement('a');
  link.href = url;
  link.setAttribute('download', `${type}_${new Date().toISOString().split('T')[0]}.xlsx`);
  document.body.appendChild(link);
  link.click();
  link.remove();
};

export default api;
```

### 6.6 ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜

#### 6.6.1 ê¶Œí•œ ê´€ë¦¬ ìœ í‹¸ë¦¬í‹°
```javascript
// utils/permissions.js
export const checkPermission = (user, permission) => {
  if (!user) return false;
  
  const userPermissions = user.permissions || [];
  return userPermissions.includes(permission);
};

export const checkCompanyPermission = (user, companyId, action) => {
  if (!user) return false;
  
  // ë³¸ì‚¬ëŠ” ëª¨ë“  ê¶Œí•œ
  if (user.company_type === 'headquarters') {
    return true;
  }
  
  // í˜‘ë ¥ì‚¬ëŠ” í•˜ìœ„ ì—…ì²´ë§Œ ì ‘ê·¼ ê°€ëŠ¥
  if (user.company_type === 'agency') {
    return user.company_id === companyId || 
           user.subordinate_companies?.includes(companyId);
  }
  
  // íŒë§¤ì ì€ ë³¸ì¸ë§Œ ì ‘ê·¼ ê°€ëŠ¥
  if (user.company_type === 'retail') {
    return user.company_id === companyId;
  }
  
  return false;
};

export const getAccessibleCompanies = (user) => {
  if (!user) return [];
  
  if (user.company_type === 'headquarters') {
    return user.all_companies || [];
  }
  
  if (user.company_type === 'agency') {
    return [user.parent_company, ...(user.subordinate_companies || [])];
  }
  
  if (user.company_type === 'retail') {
    return [user.parent_company];
  }
  
  return [];
};
```

#### 6.6.2 ë°ì´í„° í¬ë§·íŒ… ìœ í‹¸ë¦¬í‹°
```javascript
// utils/formatters.js
export const formatCurrency = (amount) => {
  return new Intl.NumberFormat('ko-KR', {
    style: 'currency',
    currency: 'KRW'
  }).format(amount);
};

export const formatDate = (date) => {
  return new Date(date).toLocaleDateString('ko-KR');
};

export const formatDateTime = (date) => {
  return new Date(date).toLocaleString('ko-KR');
};

export const formatPhoneNumber = (phone) => {
  if (!phone) return '';
  
  const cleaned = phone.replace(/\D/g, '');
  const match = cleaned.match(/^(\d{3})(\d{4})(\d{4})$/);
  
  if (match) {
    return `${match[1]}-${match[2]}-${match[3]}`;
  }
  
  return phone;
};

export const formatBusinessNumber = (number) => {
  if (!number) return '';
  
  const cleaned = number.replace(/\D/g, '');
  const match = cleaned.match(/^(\d{3})(\d{2})(\d{5})$/);
  
  if (match) {
    return `${match[1]}-${match[2]}-${match[3]}`;
  }
  
  return number;
};

export const formatStatus = (status) => {
  const statusMap = {
    pending: 'ëŒ€ê¸°ì¤‘',
    approved: 'ìŠ¹ì¸ë¨',
    rejected: 'ê±°ë¶€ë¨',
    shipped: 'ë°œì†¡ë¨',
    completed: 'ì™„ë£Œë¨'
  };
  
  return statusMap[status] || status;
};

export const getStatusColor = (status) => {
  const colorMap = {
    pending: '#ff9800',
    approved: '#4caf50',
    rejected: '#f44336',
    shipped: '#2196f3',
    completed: '#4caf50'
  };
  
  return colorMap[status] || '#757575';
};
```

### 6.7 ìŠ¤íƒ€ì¼ë§

#### 6.7.1 CSS êµ¬ì¡°
```css
/* App.css */
.app {
  display: flex;
  min-height: 100vh;
}

.main-content {
  flex: 1;
  padding: 20px;
  background-color: #f5f5f5;
}

/* Sidebar.css */
.sidebar {
  width: 250px;
  background-color: #2c3e50;
  color: white;
  display: flex;
  flex-direction: column;
}

.sidebar-header {
  padding: 20px;
  border-bottom: 1px solid #34495e;
}

.sidebar-nav {
  flex: 1;
  padding: 20px 0;
}

.nav-item {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  color: white;
  text-decoration: none;
  transition: background-color 0.3s;
}

.nav-item:hover {
  background-color: #34495e;
}

.nav-item.active {
  background-color: #3498db;
}

/* Dashboard.css */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.dashboard-card {
  background: white;
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Form.css */
.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: 500;
}

.form-group input,
.form-group select,
.form-group textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: #3498db;
  box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
}

/* Button.css */
.btn {
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.btn-primary {
  background-color: #3498db;
  color: white;
}

.btn-primary:hover {
  background-color: #2980b9;
}

.btn-success {
  background-color: #27ae60;
  color: white;
}

.btn-success:hover {
  background-color: #229954;
}

.btn-danger {
  background-color: #e74c3c;
  color: white;
}

.btn-danger:hover {
  background-color: #c0392b;
}
```

ì´ í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°ëŠ” Reactì™€ Reduxë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ëª¨ë˜í•œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ êµ¬ì¡°ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
