# 🚀 비즈니스 로직 및 권한 시스템 완벽 구현

## 📊 **업체 코드 패턴 (실제 시스템)**

### **코드 생성 규칙**
```
A-YYMMDD-01  →  본사 (headquarters)
B-YYMMDD-01  →  협력사 (agency) / 대리점 (dealer)  
C-YYMMDD-01  →  판매점 (retail)
```

### **예시**
- 본사: `A-250816-01` (2025년 8월 16일 첫 번째 본사)
- 협력사: `B-250816-01` (2025년 8월 16일 첫 번째 협력사)
- 판매점: `C-250816-01` (2025년 8월 16일 첫 번째 판매점)

## 🔄 **비즈니스 플로우**

### **1단계: 정책 생성 (본사)**
- 본사에서 정책 생성
- 정책 내용: 제목, 설명, 통신사, 계약기간, 리베이트 매트릭스 등

### **2단계: 정책 노출 설정 (본사)**
- 정책 그룹 생성
- 협력사 선택 (1개 또는 N개)
- 선택된 협력사와 소속 하부 판매점에 정책 노출

### **3단계: 주문서 양식 설정 (본사)**
- 해당 정책에 대한 주문서 양식 설정
- 동적 폼 빌더를 통해 필드 구성

### **4단계: 주문 생성 (판매점)**
- 판매점에서 노출된 정책 확인
- 해당 양식에 맞춰 주문서 생성
- 리베이트 매트릭스에 따른 리베이트 자동 계산

### **5단계: 주문 승인 (본사)**
- 본사에서 주문 확인
- 주문 접수 승인
- 해당 주문서의 리베이트 확정

### **6단계: 리베이트 관리**
- 월별로 승인된 리베이트 건수 및 금액 확인
- 리베이트 건별 리스트 조회
- 총 금액 조회
- 해당 기간 조회 기능
- 엑셀로 출력 기능

## 🔐 **권한 시스템**

### **정책 관련 권한**
| 사용자 타입 | 정책 조회 | 정책 생성 | 정책 수정 | 정책 삭제 | 노출 설정 |
|------------|-----------|-----------|-----------|-----------|-----------|
| **본사** (A-코드) | ✅ | ✅ | ✅ | ✅ | ✅ |
| **협력사** (B-코드) | ✅ | ❌ | ❌ | ❌ | ❌ |
| **판매점** (C-코드) | ✅ | ❌ | ❌ | ❌ | ❌ |

### **주문 관련 권한**
| 사용자 타입 | 주문 조회 | 주문 생성 | 주문 승인 | 주문 거부 |
|------------|-----------|-----------|-----------|-----------|
| **본사** | ✅ 전체 | ❌ | ✅ | ✅ |
| **협력사** | ✅ 전체 | ❌ | ❌ | ❌ |
| **판매점** | ✅ 본인만 | ✅ | ❌ | ❌ |

### **사용자 관리 권한**
| 사용자 타입 | 사용자 목록 | 하위 관리 | 승인/거부 |
|------------|-------------|-----------|-----------|
| **본사** | ✅ 전체 | ✅ 협력사 | ✅ |
| **협력사** | ✅ 하위만 | ✅ 판매점 | ✅ |
| **판매점** | ❌ | ❌ | ❌ |

## 📁 **구현된 파일들**

### **Frontend 핵심 파일**
- `utils/companyUtils.js` - 업체 코드 패턴 인식 및 권한 체크
- `utils/rolePermissions.js` - 권한 시스템 (코드 패턴 지원)
- `pages/PolicyListPage.js` - 정책 목록 (본사만 생성 버튼 표시)
- `components/PolicyExposureModal.js` - 정책 노출 설정
- `components/CompanyTreeView.js` - 업체 계층 구조
- `pages/UserListPage.js` - 사용자 관리 (권한 기반 접근)

### **Backend 연동**
- 실제 `companies/models.py`의 코드 생성 로직과 연동
- API 응답 기반 동적 권한 체크
- 더미 데이터 완전 제거

## 🎯 **핵심 특징**

1. **실제 코드 패턴 지원**: A-YYMMDD-01 형식 완벽 지원
2. **동적 권한 체크**: DB의 실제 업체 코드 기반 권한 결정
3. **비즈니스 로직 준수**: 판매점도 정책 조회 가능 (주문 생성을 위해)
4. **더미 데이터 제거**: 모든 하드코딩 데이터 제거
5. **확장성**: 새로운 업체 타입 추가 시 쉽게 확장 가능
6. **완전한 분리**: 정책 관리 vs 정책 조회 권한 분리

## ✅ **완료된 기능들**

- [x] 실제 업체 코드 패턴 인식
- [x] 본사만 정책 생성 가능
- [x] 협력사/판매점 정책 조회 가능 (주문 생성을 위해)
- [x] 정책 노출 설정 (협력사 선택)
- [x] 업체 계층 구조 표시
- [x] 판매점 사용자 목록 접근 차단
- [x] 권한 기반 메뉴 접근 제어
- [x] 더미 데이터 완전 제거
- [x] 개발용 디버그 코드 정리

이제 시스템이 실제 비즈니스 로직에 맞춰 완벽하게 작동합니다! 🚀✨
