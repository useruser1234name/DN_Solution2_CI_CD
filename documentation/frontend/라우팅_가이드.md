# 7. í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ëª¨ë¸ë§ ì„¤ê³„

## ğŸ¨ DN_SOLUTION2 í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ëª¨ë¸ë§ ì„¤ê³„

### 7.1 ë¦¬ëª¨ë¸ë§ ê°œìš”

#### 7.1.1 í˜„ì¬ ì‹œìŠ¤í…œ ë¶„ì„
```
í˜„ì¬ êµ¬ì¡°: React + Redux + Material-UI
ë¬¸ì œì :
- ì—­í• ë³„ í™”ë©´ ë¶„ë¦¬ ë¶€ì¡±
- ë™ì  í¼ ì²˜ë¦¬ í•œê³„
- ê¶Œí•œ ê¸°ë°˜ UI ì œì–´ ë¯¸í¡
- ì •ì±…ë³„ ì£¼ë¬¸ì„œ ì–‘ì‹ ìƒì„± ë³µì¡ì„±
```

#### 7.1.2 ë¦¬ëª¨ë¸ë§ ëª©í‘œ
```
âœ… ì—­í• ë³„ UI/UX ìµœì í™” (ë³¸ì‚¬/í˜‘ë ¥ì‚¬/íŒë§¤ì )
âœ… ê¶Œí•œ ê¸°ë°˜ ë¼ìš°íŒ… ë° ì»´í¬ë„ŒíŠ¸ ê°€ë“œ
âœ… ë™ì  í¼ ì‹œìŠ¤í…œ êµ¬ì¶•
âœ… ì •ì±… í•˜ë‹¬ í”Œë¡œìš° ê°œì„ 
âœ… ë¦¬ë² ì´íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ ê°•í™”
âœ… ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ë° ë°˜ì‘í˜• ë””ìì¸
```

### 7.2 ì—­í• ë³„ ì •ë³´êµ¬ì¡° (IA) ì„¤ê³„

#### 7.2.1 ë³¸ì‚¬ (Headquarters) IA
```
ë³¸ì‚¬ ì£¼ìš” ì„ë¬´: ì •ì±… í•˜ë‹¬, í˜‘ë ¥ì‚¬ ê´€ë¦¬, ì£¼ë¬¸ì„œ ìŠ¹ì¸

ë©”ë‰´ êµ¬ì¡°:
ğŸ“Š ëŒ€ì‹œë³´ë“œ
  â”œâ”€â”€ ì „ì‚¬ ì§€í‘œ (ì •ì±…/ì£¼ë¬¸/ë¦¬ë² ì´íŠ¸/ì •ì‚°)
  â”œâ”€â”€ ìŠ¹ì¸ ëŒ€ê¸° ì•Œë¦¼
  â””â”€â”€ ì‹¤ì‹œê°„ í™œë™ í”¼ë“œ

ğŸ“‹ ì •ì±… ê´€ë¦¬
  â”œâ”€â”€ ì •ì±… ëª©ë¡/ê²€ìƒ‰/í•„í„°
  â”œâ”€â”€ ì •ì±… ìƒì„± (5ë‹¨ê³„ ìœ„ì €ë“œ)
  â”‚   â”œâ”€â”€ 1ë‹¨ê³„: í˜‘ë ¥ì‚¬ ê·¸ë£¹ ì„ íƒ
  â”‚   â”œâ”€â”€ 2ë‹¨ê³„: ì£¼ë¬¸ì„œ ì–‘ì‹ ìƒì„±
  â”‚   â”œâ”€â”€ 3ë‹¨ê³„: ë¦¬ë² ì´íŠ¸ ë§¤íŠ¸ë¦­ìŠ¤ ì„¤ì •
  â”‚   â”œâ”€â”€ 4ë‹¨ê³„: ê³„ì•½ ì¡°ê±´ ì„¤ì •
  â”‚   â””â”€â”€ 5ë‹¨ê³„: ì •ì±… ë°°í¬
  â”œâ”€â”€ ì •ì±… ìˆ˜ì •/ì‚­ì œ
  â””â”€â”€ ì •ì±… ë°°í¬ í˜„í™©

ğŸ¢ ì¡°ì§ ê´€ë¦¬
  â”œâ”€â”€ í˜‘ë ¥ì‚¬ ëª©ë¡/ìƒì„¸/ìŠ¹ì¸
  â”œâ”€â”€ íŒë§¤ì  í˜„í™© (í˜‘ë ¥ì‚¬ë³„)
  â””â”€â”€ ê³„ì¸µ êµ¬ì¡° ì‹œê°í™”

ğŸ“ ì£¼ë¬¸ ìŠ¹ì¸
  â”œâ”€â”€ ìŠ¹ì¸ ëŒ€ê¸° í
  â”œâ”€â”€ ì£¼ë¬¸ ìƒì„¸ ê²€í† 
  â”œâ”€â”€ ìŠ¹ì¸/ë°˜ë ¤ ì²˜ë¦¬
  â””â”€â”€ ìš´ì†¡ì¥ ê´€ë¦¬

ğŸ’° ë¦¬ë² ì´íŠ¸ ê´€ë¦¬
  â”œâ”€â”€ í˜‘ë ¥ì‚¬ë³„ í• ë‹¹ ê´€ë¦¬
  â”œâ”€â”€ í• ë‹¹ ë‚´ì—­ ì¡°íšŒ
  â””â”€â”€ ì‚¬ìš© í˜„í™© ëª¨ë‹ˆí„°ë§

ğŸ“Š ì •ì‚° ê´€ë¦¬
  â”œâ”€â”€ í˜‘ë ¥ì‚¬ë³„ ì •ì‚° ì§‘ê³„
  â”œâ”€â”€ ì •ì‚° ìŠ¹ì¸ ì²˜ë¦¬
  â””â”€â”€ ê³„ì¸µë³„ ì •ì‚° ë‚´ì—­

ğŸ“ˆ ë¦¬í¬íŠ¸/ì—‘ì…€
  â”œâ”€â”€ ì „ì‚¬ í†µê³„ ëŒ€ì‹œë³´ë“œ
  â”œâ”€â”€ ì •ì‚° ìƒì„¸ ë‚´ì—­ ì—‘ì…€
  â”œâ”€â”€ ê³„ì¸µë³„ ì •ì‚° ë‚´ì—­ ì—‘ì…€
  â””â”€â”€ ì»¤ìŠ¤í…€ ë¦¬í¬íŠ¸ ìƒì„±
```

#### 7.2.2 í˜‘ë ¥ì‚¬ (Agency) IA
```
í˜‘ë ¥ì‚¬ ì£¼ìš” ì„ë¬´: íŒë§¤ì  ê´€ë¦¬, ì •ì±… í™•ì¸, ì£¼ë¬¸ì„œ í™•ì¸, ë¦¬ë² ì´íŠ¸ ë¶„ë°°

ë©”ë‰´ êµ¬ì¡°:
ğŸ“Š ëŒ€ì‹œë³´ë“œ
  â”œâ”€â”€ ì†Œì† ì§€í‘œ (ì •ì±…/ì£¼ë¬¸/ë¦¬ë² ì´íŠ¸)
  â”œâ”€â”€ íŒë§¤ì  í˜„í™©
  â””â”€â”€ ì•Œë¦¼ ì„¼í„°

ğŸ“‹ ì •ì±… ê´€ë¦¬ (ì¡°íšŒ ì „ìš©)
  â”œâ”€â”€ ë°°ì •ë°›ì€ ì •ì±… ëª©ë¡
  â”œâ”€â”€ ì •ì±… ìƒì„¸ ì¡°íšŒ
  â”œâ”€â”€ ì£¼ë¬¸ì„œ ì–‘ì‹ ë¯¸ë¦¬ë³´ê¸°
  â””â”€â”€ ë¦¬ë² ì´íŠ¸ í‘œ í™•ì¸

ğŸª íŒë§¤ì  ê´€ë¦¬
  â”œâ”€â”€ ì˜ˆí•˜ íŒë§¤ì  ëª©ë¡
  â”œâ”€â”€ íŒë§¤ì  ìƒì„¸/ìˆ˜ì •
  â”œâ”€â”€ íŒë§¤ì  ìŠ¹ì¸ ê´€ë¦¬
  â””â”€â”€ íŒë§¤ì  ì„±ê³¼ í˜„í™©

ğŸ“ ì£¼ë¬¸ ê´€ë¦¬
  â”œâ”€â”€ ì˜ˆí•˜ íŒë§¤ì  ì£¼ë¬¸ í˜„í™©
  â”œâ”€â”€ ì£¼ë¬¸ ìƒì„¸ ì¡°íšŒ
  â”œâ”€â”€ ì£¼ë¬¸ í†µê³„ (íŒë§¤ì ë³„)
  â””â”€â”€ ì£¼ë¬¸ ê²€ìƒ‰/í•„í„°

ğŸ’° ë¦¬ë² ì´íŠ¸ ê´€ë¦¬
  â”œâ”€â”€ ë‚´ ë¦¬ë² ì´íŠ¸ ìˆ˜ë ¹ í˜„í™©
  â”œâ”€â”€ íŒë§¤ì ë³„ ë¦¬ë² ì´íŠ¸ ë¶„ë°°
  â”œâ”€â”€ ë¶„ë°° ë‚´ì—­ ê´€ë¦¬
  â””â”€â”€ ë¦¬ë² ì´íŠ¸ ì”ì•¡ í˜„í™©

ğŸ“Š ì •ì‚° ê´€ë¦¬
  â”œâ”€â”€ ì†Œì† íŒë§¤ì  ì •ì‚° ì§‘ê³„
  â”œâ”€â”€ ì •ì‚° ë‚´ì—­ ì¡°íšŒ
  â””â”€â”€ ì •ì‚° ìŠ¹ì¸ ì²˜ë¦¬

ğŸ“ˆ ë¦¬í¬íŠ¸/ì—‘ì…€
  â”œâ”€â”€ ì†Œì† í†µê³„ ëŒ€ì‹œë³´ë“œ
  â”œâ”€â”€ ë‚´ ë¦¬ë² ì´íŠ¸ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
  â”œâ”€â”€ íŒë§¤ì ë³„ ë¦¬ë² ì´íŠ¸ ì—‘ì…€
  â””â”€â”€ ì •ì‚° ë‚´ì—­ ì—‘ì…€
```

#### 7.2.3 íŒë§¤ì  (Retail) IA
```
íŒë§¤ì  ì£¼ìš” ì„ë¬´: ì •ì±… í™•ì¸, ì£¼ë¬¸ì„œ ì‘ì„±, ë¦¬ë² ì´íŠ¸ í™•ì¸

ë©”ë‰´ êµ¬ì¡°:
ğŸ“Š ëŒ€ì‹œë³´ë“œ
  â”œâ”€â”€ ë‚´ ì§€í‘œ (ì£¼ë¬¸/ë¦¬ë² ì´íŠ¸/ì •ì‚°)
  â”œâ”€â”€ ì´ë²ˆ ë‹¬ ì„±ê³¼
  â””â”€â”€ ì•Œë¦¼ ì„¼í„°

ğŸ“‹ ì •ì±… ê´€ë¦¬ (ì¡°íšŒ ì „ìš©)
  â”œâ”€â”€ ì ìš© ê°€ëŠ¥í•œ ì •ì±… ëª©ë¡
  â”œâ”€â”€ ì •ì±… ìƒì„¸ ì¡°íšŒ
  â”œâ”€â”€ ì£¼ë¬¸ì„œ ì–‘ì‹ í™•ì¸
  â””â”€â”€ ë¦¬ë² ì´íŠ¸ ì •ë³´ í™•ì¸

ğŸ“ ì£¼ë¬¸ ê´€ë¦¬
  â”œâ”€â”€ ì£¼ë¬¸ì„œ ì‘ì„±
  â”‚   â”œâ”€â”€ ì •ì±… ì„ íƒ
  â”‚   â”œâ”€â”€ í†µì‹ ì‚¬/ìš”ê¸ˆì œ ì„ íƒ
  â”‚   â”œâ”€â”€ ê³ ê° ì •ë³´ ì…ë ¥
  â”‚   â””â”€â”€ ì£¼ë¬¸ ì œì¶œ
  â”œâ”€â”€ ë‚´ ì£¼ë¬¸ ë‚´ì—­
  â”œâ”€â”€ ì£¼ë¬¸ ìƒíƒœ ì¶”ì 
  â””â”€â”€ ì£¼ë¬¸ ìˆ˜ì •/ì·¨ì†Œ

ğŸ’° ë¦¬ë² ì´íŠ¸ ê´€ë¦¬
  â”œâ”€â”€ ë‚´ ë¦¬ë² ì´íŠ¸ ìˆ˜ë ¹ í˜„í™©
  â”œâ”€â”€ í• ë‹¹ ì”ì•¡ í™•ì¸
  â”œâ”€â”€ ì‚¬ìš© ë‚´ì—­ ì¡°íšŒ
  â””â”€â”€ ê¸°ê°„ë³„ ë¦¬ë² ì´íŠ¸ ì¡°íšŒ

ğŸ“Š ì •ì‚° ê´€ë¦¬
  â”œâ”€â”€ ë‚´ ì •ì‚° ë‚´ì—­
  â”œâ”€â”€ ì›”ë³„ ìˆ˜ìµ í˜„í™©
  â””â”€â”€ ì •ì‚° ìƒíƒœ í™•ì¸

ğŸ“ˆ ë¦¬í¬íŠ¸/ì—‘ì…€
  â”œâ”€â”€ ë‚´ í†µê³„ ëŒ€ì‹œë³´ë“œ
  â”œâ”€â”€ ë‚´ ë¦¬ë² ì´íŠ¸ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
  â”œâ”€â”€ ì£¼ë¬¸ ë‚´ì—­ ì—‘ì…€
  â””â”€â”€ ì •ì‚° ë‚´ì—­ ì—‘ì…€
```

### 7.3 ë¼ìš°íŒ… ë° ê¶Œí•œ ê°€ë“œ ì‹œìŠ¤í…œ

#### 7.3.1 ë¼ìš°íŒ… êµ¬ì¡°
```typescript
// routes.ts
export const routes = [
  // ê³µí†µ í˜ì´ì§€
  { path: "/dashboard", roles: ["hq","agency","retail"] },

  // ì •ì±… ê´€ë¦¬
  { path: "/policies", roles: ["hq","agency","retail"] },
  { path: "/policies/create", roles: ["hq"] },              // ë³¸ì‚¬ë§Œ
  { path: "/policies/:id", roles: ["hq","agency","retail"] },
  { path: "/policies/:id/edit", roles: ["hq"] },            // ë³¸ì‚¬ë§Œ

  // ì£¼ë¬¸ ê´€ë¦¬
  { path: "/orders", roles: ["hq","agency","retail"] },     // ê°€ì‹œ ë²”ìœ„ ë‹¤ë¦„
  { path: "/orders/create", roles: ["retail"] },            // íŒë§¤ì ë§Œ
  { path: "/orders/:id", roles: ["hq","agency","retail"] },
  { path: "/orders/:id/edit", roles: ["retail"] },          // íŒë§¤ì ë§Œ
  { path: "/orders/approval", roles: ["hq"] },              // ë³¸ì‚¬ ìŠ¹ì¸ í

  // ì¡°ì§ ê´€ë¦¬
  { path: "/agencies", roles: ["hq"] },                     // ë³¸ì‚¬ë§Œ
  { path: "/retailers", roles: ["hq","agency"] },           // ë³¸ì‚¬/í˜‘ë ¥ì‚¬

  // ë¦¬ë² ì´íŠ¸ ê´€ë¦¬
  { path: "/rebates/my", roles: ["agency","retail"] },      // í˜‘ë ¥ì‚¬/íŒë§¤ì 
  { path: "/rebates/retailers", roles: ["agency"] },        // í˜‘ë ¥ì‚¬ë§Œ
  { path: "/rebates/agencies", roles: ["hq"] },             // ë³¸ì‚¬ë§Œ
  { path: "/rebates/allocate", roles: ["hq"] },             // ë³¸ì‚¬ë§Œ
  { path: "/rebates/distribute", roles: ["agency"] },       // í˜‘ë ¥ì‚¬ë§Œ

  // ì •ì‚° ê´€ë¦¬
  { path: "/settlements", roles: ["hq","agency","retail"] }, // ê°€ì‹œ ë²”ìœ„ ë‹¤ë¦„
  { path: "/settlements/approval", roles: ["hq"] },          // ë³¸ì‚¬ë§Œ

  // ë¦¬í¬íŠ¸/ì—‘ì…€
  { path: "/reports", roles: ["hq","agency","retail"] },     // ê¶Œí•œë³„ ë‹¤ë¦„
  { path: "/exports", roles: ["hq","agency","retail"] },     // ê¶Œí•œë³„ ë‹¤ë¦„
];
```

#### 7.3.2 ê¶Œí•œ ê°€ë“œ ì»´í¬ë„ŒíŠ¸
```typescript
// RoleGuard.tsx
interface RoleGuardProps {
  roles: string[];
  children: React.ReactNode;
  fallback?: React.ReactNode;
}

const RoleGuard: React.FC<RoleGuardProps> = ({ roles, children, fallback = null }) => {
  const { user } = useAuth();
  
  if (!user || !roles.includes(user.company_type)) {
    return fallback || <Navigate to="/dashboard" replace />;
  }
  
  return <>{children}</>;
};

// ì‚¬ìš© ì˜ˆì‹œ
<RoleGuard roles={["hq"]}>
  <PolicyCreateButton />
</RoleGuard>
```

#### 7.3.3 ë©”ë‰´ ìë™ í•„í„°ë§
```typescript
// Sidebar.tsx
const Sidebar = () => {
  const { user } = useAuth();
  
  const getFilteredMenuItems = () => {
    return menuItems.filter(item => 
      item.roles.includes(user?.company_type)
    );
  };
  
  return (
    <nav>
      {getFilteredMenuItems().map(item => (
        <NavLink key={item.path} to={item.path}>
          {item.label}
        </NavLink>
      ))}
    </nav>
  );
};
```

### 7.4 ì •ì±… í•˜ë‹¬ í”Œë¡œìš° ì„¤ê³„

#### 7.4.1 ì •ì±… ìƒì„± 5ë‹¨ê³„ ìœ„ì €ë“œ (ë³¸ì‚¬ ì „ìš©)
```typescript
// PolicyCreateWizard.tsx
const PolicyCreateWizard = () => {
  const [currentStep, setCurrentStep] = useState(1);
  const [policyData, setPolicyData] = useState({
    name: '',
    description: '',
    selectedCompanies: [],
    formFields: [],
    rebateMatrix: [],
    contractTerms: {},
  });

  const steps = [
    { id: 1, title: "í˜‘ë ¥ì‚¬ ê·¸ë£¹ ì„ íƒ", component: CompanyGroupSelector },
    { id: 2, title: "ì£¼ë¬¸ì„œ ì–‘ì‹ ìƒì„±", component: FormFieldBuilder },
    { id: 3, title: "ë¦¬ë² ì´íŠ¸ ë§¤íŠ¸ë¦­ìŠ¤", component: RebateMatrixEditor },
    { id: 4, title: "ê³„ì•½ ì¡°ê±´ ì„¤ì •", component: ContractTermsEditor },
    { id: 5, title: "ì •ì±… ë°°í¬", component: PolicyDeployment },
  ];

  return (
    <div className="policy-wizard">
      <WizardHeader steps={steps} currentStep={currentStep} />
      <WizardContent>
        {React.createElement(steps[currentStep - 1].component, {
          data: policyData,
          onChange: setPolicyData,
          onNext: () => setCurrentStep(currentStep + 1),
          onPrev: () => setCurrentStep(currentStep - 1),
        })}
      </WizardContent>
    </div>
  );
};
```

#### 7.4.2 1ë‹¨ê³„: í˜‘ë ¥ì‚¬ ê·¸ë£¹ ì„ íƒ
```typescript
// CompanyGroupSelector.tsx
const CompanyGroupSelector = ({ data, onChange, onNext }) => {
  const [selectedAgencies, setSelectedAgencies] = useState([]);
  const [subordinateRetailers, setSubordinateRetailers] = useState([]);

  const handleAgencySelect = async (agencyIds) => {
    setSelectedAgencies(agencyIds);
    
    // ì„ íƒëœ í˜‘ë ¥ì‚¬ì˜ ì˜ˆí•˜ íŒë§¤ì  ìë™ ì¡°íšŒ
    const retailers = await fetchSubordinateRetailers(agencyIds);
    setSubordinateRetailers(retailers);
  };

  return (
    <div className="company-group-selector">
      <h3>ì •ì±…ì„ ì ìš©í•  í˜‘ë ¥ì‚¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
      
      <AgencyCheckboxList
        agencies={agencies}
        selectedIds={selectedAgencies}
        onChange={handleAgencySelect}
      />
      
      {subordinateRetailers.length > 0 && (
        <div className="subordinate-preview">
          <h4>ìë™ í¬í•¨ë  íŒë§¤ì  ({subordinateRetailers.length}ê°œ)</h4>
          <RetailerList retailers={subordinateRetailers} />
        </div>
      )}
      
      <WizardActions>
        <Button onClick={() => onNext({ selectedCompanies: [...selectedAgencies, ...subordinateRetailers] })}>
          ë‹¤ìŒ ë‹¨ê³„
        </Button>
      </WizardActions>
    </div>
  );
};
```

#### 7.4.3 2ë‹¨ê³„: ì£¼ë¬¸ì„œ ì–‘ì‹ ìƒì„±
```typescript
// FormFieldBuilder.tsx
const FormFieldBuilder = ({ data, onChange, onNext }) => {
  const [availableFields] = useState([
    { id: 'customer_name', label: 'ê³ ê°ëª…', type: 'text', required: true },
    { id: 'customer_phone', label: 'ì—°ë½ì²˜', type: 'text', required: true },
    { id: 'customer_address', label: 'ì£¼ì†Œ', type: 'text', required: false },
    { id: 'telecom_provider', label: 'í†µì‹ ì‚¬', type: 'select', options: ['SKT', 'KT', 'LGU'] },
    { id: 'plan', label: 'ìš”ê¸ˆì œ', type: 'select', dependsOn: 'telecom_provider' },
    { id: 'device_model', label: 'ë‹¨ë§ê¸° ëª¨ë¸', type: 'text', required: false },
    { id: 'shipping_address', label: 'ë°°ì†¡ ì£¼ì†Œ', type: 'text', required: false },
  ]);

  const [selectedFields, setSelectedFields] = useState([]);

  return (
    <div className="form-field-builder">
      <div className="field-library">
        <h3>ì‚¬ìš© ê°€ëŠ¥í•œ í•„ë“œ</h3>
        {availableFields.map(field => (
          <FieldCard
            key={field.id}
            field={field}
            onAdd={() => addField(field)}
          />
        ))}
      </div>
      
      <div className="form-preview">
        <h3>ì£¼ë¬¸ì„œ ì–‘ì‹ ë¯¸ë¦¬ë³´ê¸°</h3>
        <DraggableFieldList
          fields={selectedFields}
          onReorder={setSelectedFields}
          onRemove={removeField}
          onConfigure={configureField}
        />
      </div>
    </div>
  );
};
```

#### 7.4.4 3ë‹¨ê³„: ë¦¬ë² ì´íŠ¸ ë§¤íŠ¸ë¦­ìŠ¤ ì„¤ì •
```typescript
// RebateMatrixEditor.tsx
const RebateMatrixEditor = ({ data, onChange, onNext }) => {
  const telecomProviders = ['SKT', 'KT', 'LGU'];
  const planCategories = ['10K+', '8K', '6K', '4K'];
  
  const [rebateMatrix, setRebateMatrix] = useState(() => {
    // í†µì‹ ì‚¬ Ã— ìš”ê¸ˆì œ ì¹´í…Œê³ ë¦¬ ë§¤íŠ¸ë¦­ìŠ¤ ì´ˆê¸°í™”
    return telecomProviders.flatMap(provider =>
      planCategories.map(category => ({
        provider,
        category,
        amount: 0,
      }))
    );
  });

  return (
    <div className="rebate-matrix-editor">
      <h3>í†µì‹ ì‚¬ë³„ ìš”ê¸ˆì œ ë¦¬ë² ì´íŠ¸ ì„¤ì •</h3>
      
      <table className="rebate-matrix">
        <thead>
          <tr>
            <th>í†µì‹ ì‚¬</th>
            {planCategories.map(category => (
              <th key={category}>{category}</th>
            ))}
          </tr>
        </thead>
        <tbody>
          {telecomProviders.map(provider => (
            <tr key={provider}>
              <td className="provider-name">{provider}</td>
              {planCategories.map(category => (
                <td key={`${provider}-${category}`}>
                  <CurrencyInput
                    value={getRebateAmount(provider, category)}
                    onChange={(amount) => setRebateAmount(provider, category, amount)}
                  />
                </td>
              ))}
            </tr>
          ))}
        </tbody>
      </table>
      
      <div className="matrix-actions">
        <Button variant="secondary" onClick={importFromExcel}>
          ì—‘ì…€ì—ì„œ ê°€ì ¸ì˜¤ê¸°
        </Button>
        <Button variant="secondary" onClick={applyTemplate}>
          í…œí”Œë¦¿ ì ìš©
        </Button>
      </div>
    </div>
  );
};
```

### 7.5 ë™ì  ì£¼ë¬¸ì„œ ì–‘ì‹ ì‹œìŠ¤í…œ

#### 7.5.1 JSON ìŠ¤í‚¤ë§ˆ ì •ì˜
```typescript
// FormSchema.ts
interface FormFieldSchema {
  id: string;
  label: string;
  type: 'text' | 'select' | 'date' | 'checkbox' | 'radio' | 'file';
  required: boolean;
  order: number;
  options?: string[];
  dependsOn?: string;
  optionsSource?: string; // API ì—”ë“œí¬ì¸íŠ¸
  validation?: {
    pattern?: string;
    minLength?: number;
    maxLength?: number;
    min?: number;
    max?: number;
  };
  mask?: 'phone' | 'business-number' | 'credit-card';
  placeholder?: string;
  helpText?: string;
}

interface PolicyFormSchema {
  policyId: string;
  policyName: string;
  fields: FormFieldSchema[];
}
```

#### 7.5.2 ë™ì  í¼ ë Œë”ëŸ¬
```typescript
// DynamicFormRenderer.tsx
const DynamicFormRenderer = ({ schema, onSubmit, initialData = {} }) => {
  const [formData, setFormData] = useState(initialData);
  const [fieldOptions, setFieldOptions] = useState({});

  // ì˜ì¡´ì„± í•„ë“œ ì²˜ë¦¬
  useEffect(() => {
    schema.fields.forEach(field => {
      if (field.dependsOn && field.optionsSource) {
        const dependencyValue = formData[field.dependsOn];
        if (dependencyValue) {
          loadFieldOptions(field.id, field.optionsSource, dependencyValue);
        }
      }
    });
  }, [formData, schema.fields]);

  const loadFieldOptions = async (fieldId, source, dependencyValue) => {
    try {
      const url = source.replace(`{${field.dependsOn}}`, dependencyValue);
      const response = await api.get(url);
      setFieldOptions(prev => ({
        ...prev,
        [fieldId]: response.data
      }));
    } catch (error) {
      console.error(`Failed to load options for ${fieldId}:`, error);
    }
  };

  const renderField = (field: FormFieldSchema) => {
    const commonProps = {
      key: field.id,
      name: field.id,
      label: field.label,
      required: field.required,
      value: formData[field.id] || '',
      onChange: (value) => setFormData(prev => ({ ...prev, [field.id]: value })),
      helpText: field.helpText,
      placeholder: field.placeholder,
    };

    switch (field.type) {
      case 'text':
        return (
          <TextInput
            {...commonProps}
            mask={field.mask}
            validation={field.validation}
          />
        );
      
      case 'select':
        return (
          <SelectInput
            {...commonProps}
            options={fieldOptions[field.id] || field.options || []}
            loading={field.dependsOn && !fieldOptions[field.id]}
          />
        );
      
      case 'date':
        return <DateInput {...commonProps} />;
      
      case 'checkbox':
        return (
          <CheckboxInput
            {...commonProps}
            options={field.options || []}
          />
        );
      
      case 'file':
        return (
          <FileInput
            {...commonProps}
            accept={field.validation?.pattern}
          />
        );
      
      default:
        return null;
    }
  };

  const sortedFields = schema.fields.sort((a, b) => a.order - b.order);

  return (
    <form onSubmit={(e) => { e.preventDefault(); onSubmit(formData); }}>
      <div className="dynamic-form">
        {sortedFields.map(renderField)}
      </div>
      
      <div className="form-actions">
        <Button type="submit" variant="primary">
          ì£¼ë¬¸ì„œ ì œì¶œ
        </Button>
      </div>
    </form>
  );
};
```

### 7.6 ë¦¬ë² ì´íŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ

#### 7.6.1 3ë‹¨ê³„ ë¦¬ë² ì´íŠ¸ íë¦„
```typescript
// RebateFlowDiagram.tsx
const RebateFlow = {
  // 1ë‹¨ê³„: ë³¸ì‚¬ â†’ í˜‘ë ¥ì‚¬ í• ë‹¹
  allocation: {
    actor: "ë³¸ì‚¬ (HQ)",
    action: "í˜‘ë ¥ì‚¬ë³„ ë¦¬ë² ì´íŠ¸ í• ë‹¹",
    component: "RebateAllocator",
    api: "POST /api/rebates/allocate",
  },
  
  // 2ë‹¨ê³„: í˜‘ë ¥ì‚¬ â†’ íŒë§¤ì  ë¶„ë°°
  distribution: {
    actor: "í˜‘ë ¥ì‚¬ (Agency)", 
    action: "ì˜ˆí•˜ íŒë§¤ì ì— ë¦¬ë² ì´íŠ¸ ë¶„ë°°",
    component: "RebateDistributor",
    api: "POST /api/rebates/distribute",
  },
  
  // 3ë‹¨ê³„: íŒë§¤ì  â†’ ì£¼ë¬¸ ì‹œ ì‚¬ìš©
  usage: {
    actor: "íŒë§¤ì  (Retail)",
    action: "ì£¼ë¬¸ ìƒì„± ì‹œ ë¦¬ë² ì´íŠ¸ ì°¨ê°",
    component: "RebateBalance",
    api: "GET/PUT /api/rebates/balance",
  },
};
```

#### 7.6.2 ë¦¬ë² ì´íŠ¸ í• ë‹¹ ì»´í¬ë„ŒíŠ¸ (ë³¸ì‚¬)
```typescript
// RebateAllocator.tsx
const RebateAllocator = () => {
  const [selectedPeriod, setSelectedPeriod] = useState({
    startDate: '',
    endDate: '',
  });
  const [agencies, setAgencies] = useState([]);
  const [allocations, setAllocations] = useState([]);

  const handleBulkAllocate = async () => {
    try {
      await api.post('/api/rebates/allocate/bulk', {
        period: selectedPeriod,
        allocations: allocations,
      });
      
      toast.success('ë¦¬ë² ì´íŠ¸ í• ë‹¹ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
      
      // í˜‘ë ¥ì‚¬ë“¤ì—ê²Œ ì‹¤ì‹œê°„ ì•Œë¦¼
      await sendNotification('rebate_allocated', allocations.map(a => a.agencyId));
      
    } catch (error) {
      toast.error('ë¦¬ë² ì´íŠ¸ í• ë‹¹ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }
  };

  return (
    <div className="rebate-allocator">
      <div className="period-selector">
        <DateRangePicker
          startDate={selectedPeriod.startDate}
          endDate={selectedPeriod.endDate}
          onChange={setSelectedPeriod}
        />
      </div>
      
      <div className="allocation-table">
        <DataTable
          columns={[
            { key: 'agencyName', title: 'í˜‘ë ¥ì‚¬ëª…' },
            { key: 'currentBalance', title: 'í˜„ì¬ ì”ì•¡' },
            { key: 'allocationAmount', title: 'í• ë‹¹ ê¸ˆì•¡', editable: true },
            { key: 'totalBalance', title: 'í• ë‹¹ í›„ ì”ì•¡' },
          ]}
          data={agencies}
          onChange={setAllocations}
        />
      </div>
      
      <div className="allocation-summary">
        <SummaryCard
          totalAmount={allocations.reduce((sum, a) => sum + a.amount, 0)}
          agencyCount={allocations.length}
        />
      </div>
      
      <div className="actions">
        <Button onClick={handleBulkAllocate} variant="primary">
          ì¼ê´„ í• ë‹¹
        </Button>
      </div>
    </div>
  );
};
```

### 7.7 ì—­í• ë³„ ëŒ€ì‹œë³´ë“œ ì„¤ê³„

#### 7.7.1 ë³¸ì‚¬ ëŒ€ì‹œë³´ë“œ
```typescript
// HQDashboard.tsx
const HQDashboard = () => {
  const [dashboardData, setDashboardData] = useState(null);

  return (
    <DashboardLayout>
      <div className="dashboard-grid hq-dashboard">
        {/* ì „ì‚¬ ì§€í‘œ */}
        <MetricCard
          title="ì „ì²´ ì •ì±…"
          value={dashboardData?.totalPolicies}
          trend="+12%"
          icon="policy"
        />
        
        <MetricCard
          title="ìŠ¹ì¸ ëŒ€ê¸° ì£¼ë¬¸"
          value={dashboardData?.pendingOrders}
          status="warning"
          icon="pending"
        />
        
        <MetricCard
          title="ì´ë²ˆ ë‹¬ ë¦¬ë² ì´íŠ¸"
          value={formatCurrency(dashboardData?.monthlyRebate)}
          trend="+8%"
          icon="money"
        />
        
        {/* ìŠ¹ì¸ í ìœ„ì ¯ */}
        <ApprovalQueueWidget
          pendingOrders={dashboardData?.approvalQueue}
          onApprove={handleOrderApprove}
        />
        
        {/* í˜‘ë ¥ì‚¬ í˜„í™© */}
        <AgencyStatusWidget
          agencies={dashboardData?.agencies}
        />
        
        {/* ì‹¤ì‹œê°„ í™œë™ í”¼ë“œ */}
        <ActivityFeedWidget
          activities={dashboardData?.recentActivities}
        />
        
        {/* ì •ì‚° í˜„í™© ì°¨íŠ¸ */}
        <SettlementChartWidget
          data={dashboardData?.settlementTrend}
        />
      </div>
    </DashboardLayout>
  );
};
```

#### 7.7.2 í˜‘ë ¥ì‚¬ ëŒ€ì‹œë³´ë“œ
```typescript
// AgencyDashboard.tsx
const AgencyDashboard = () => {
  return (
    <DashboardLayout>
      <div className="dashboard-grid agency-dashboard">
        {/* ì†Œì† ì§€í‘œ */}
        <MetricCard
          title="ë°°ì •ë°›ì€ ì •ì±…"
          value={dashboardData?.assignedPolicies}
          icon="policy"
        />
        
        <MetricCard
          title="ì˜ˆí•˜ íŒë§¤ì "
          value={dashboardData?.retailerCount}
          status="success"
          icon="store"
        />
        
        <MetricCard
          title="ì´ë²ˆ ë‹¬ ë¦¬ë² ì´íŠ¸"
          value={formatCurrency(dashboardData?.myRebate)}
          trend="+5%"
          icon="money"
        />
        
        {/* íŒë§¤ì  í˜„í™© */}
        <RetailerStatusWidget
          retailers={dashboardData?.retailers}
        />
        
        {/* ë¦¬ë² ì´íŠ¸ ë¶„ë°° í˜„í™© */}
        <RebateDistributionWidget
          distributions={dashboardData?.rebateDistribution}
        />
        
        {/* ì£¼ë¬¸ í˜„í™© ì°¨íŠ¸ */}
        <OrderTrendWidget
          data={dashboardData?.orderTrend}
        />
      </div>
    </DashboardLayout>
  );
};
```

#### 7.7.3 íŒë§¤ì  ëŒ€ì‹œë³´ë“œ
```typescript
// RetailDashboard.tsx  
const RetailDashboard = () => {
  return (
    <DashboardLayout>
      <div className="dashboard-grid retail-dashboard">
        {/* ë‚´ ì§€í‘œ */}
        <MetricCard
          title="ì´ë²ˆ ë‹¬ ì£¼ë¬¸"
          value={dashboardData?.monthlyOrders}
          trend="+15%"
          icon="order"
        />
        
        <MetricCard
          title="ë¦¬ë² ì´íŠ¸ ì”ì•¡"
          value={formatCurrency(dashboardData?.rebateBalance)}
          status="info"
          icon="wallet"
        />
        
        <MetricCard
          title="ì´ë²ˆ ë‹¬ ìˆ˜ìµ"
          value={formatCurrency(dashboardData?.monthlyProfit)}
          trend="+20%"
          icon="profit"
        />
        
        {/* ì£¼ë¬¸ ìƒì„± ë°”ë¡œê°€ê¸° */}
        <QuickOrderWidget
          availablePolicies={dashboardData?.availablePolicies}
          onCreateOrder={handleCreateOrder}
        />
        
        {/* ìµœê·¼ ì£¼ë¬¸ í˜„í™© */}
        <RecentOrdersWidget
          orders={dashboardData?.recentOrders}
        />
        
        {/* ë¦¬ë² ì´íŠ¸ ì‚¬ìš© í˜„í™© */}
        <RebateUsageWidget
          usage={dashboardData?.rebateUsage}
        />
      </div>
    </DashboardLayout>
  );
};
```

### 7.8 ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì‹œìŠ¤í…œ

#### 7.8.1 ì—­í• ë³„ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ê¶Œí•œ
```typescript
// ExcelExportCenter.tsx
const ExcelExportCenter = () => {
  const { user } = useAuth();
  
  const getAvailableExports = () => {
    const baseExports = [
      { id: 'orders', title: 'ì£¼ë¬¸ ë‚´ì—­', scope: 'own' },
      { id: 'rebates', title: 'ë¦¬ë² ì´íŠ¸ ë‚´ì—­', scope: 'own' },
    ];
    
    switch (user.company_type) {
      case 'hq':
        return [
          ...baseExports,
          { id: 'settlements_detailed', title: 'ì •ì‚° ìƒì„¸ ë‚´ì—­', scope: 'all' },
          { id: 'settlements_hierarchical', title: 'ê³„ì¸µë³„ ì •ì‚° ë‚´ì—­', scope: 'all' },
          { id: 'agency_rebates', title: 'í˜‘ë ¥ì‚¬ ë¦¬ë² ì´íŠ¸ í˜„í™©', scope: 'subordinates' },
          { id: 'policy_distribution', title: 'ì •ì±… ë°°í¬ í˜„í™©', scope: 'all' },
        ];
        
      case 'agency':
        return [
          ...baseExports,
          { id: 'retailer_rebates', title: 'íŒë§¤ì  ë¦¬ë² ì´íŠ¸ í˜„í™©', scope: 'subordinates' },
          { id: 'retailer_orders', title: 'íŒë§¤ì  ì£¼ë¬¸ í˜„í™©', scope: 'subordinates' },
        ];
        
      case 'retail':
        return baseExports;
        
      default:
        return [];
    }
  };

  return (
    <div className="excel-export-center">
      <div className="export-filters">
        <DateRangePicker
          startDate={filters.startDate}
          endDate={filters.endDate}
          onChange={setFilters}
        />
        
        <CompanyScopeFilter
          userRole={user.company_type}
          selectedCompanies={filters.companies}
          onChange={(companies) => setFilters(prev => ({ ...prev, companies }))}
        />
      </div>
      
      <div className="export-options">
        {getAvailableExports().map(exportOption => (
          <ExportCard
            key={exportOption.id}
            title={exportOption.title}
            scope={exportOption.scope}
            onExport={() => handleExport(exportOption.id)}
          />
        ))}
      </div>
    </div>
  );
};
```

### 7.9 ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œìŠ¤í…œ

#### 7.9.1 WebSocket ì—°ê²° ê´€ë¦¬
```typescript
// useWebSocket.ts
const useWebSocket = () => {
  const { user } = useAuth();
  const [socket, setSocket] = useState(null);

  useEffect(() => {
    if (user) {
      const ws = new WebSocket(`ws://localhost:8000/ws/notifications/${user.company_id}/`);
      
      ws.onmessage = (event) => {
        const notification = JSON.parse(event.data);
        handleNotification(notification);
      };
      
      setSocket(ws);
      
      return () => {
        ws.close();
      };
    }
  }, [user]);

  const handleNotification = (notification) => {
    switch (notification.type) {
      case 'order_created':
        // ì£¼ë¬¸ ìƒì„± ì•Œë¦¼
        toast.info(`ìƒˆë¡œìš´ ì£¼ë¬¸ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤: ${notification.order_id}`);
        // ëŒ€ì‹œë³´ë“œ ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        queryClient.invalidateQueries('dashboard');
        break;
        
      case 'order_approved':
        toast.success(`ì£¼ë¬¸ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤: ${notification.order_id}`);
        break;
        
      case 'rebate_allocated':
        toast.info(`ë¦¬ë² ì´íŠ¸ê°€ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤: ${notification.amount}ì›`);
        queryClient.invalidateQueries('rebates');
        break;
        
      case 'policy_assigned':
        toast.info(`ìƒˆë¡œìš´ ì •ì±…ì´ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤: ${notification.policy_name}`);
        queryClient.invalidateQueries('policies');
        break;
    }
  };

  return socket;
};
```

### 7.10 êµ¬í˜„ ìš°ì„ ìˆœìœ„

#### 7.10.1 Phase 1: í•µì‹¬ ì¸í”„ë¼ (4ì£¼)
```
âœ… ê¶Œí•œ ê¸°ë°˜ ë¼ìš°íŒ… ì‹œìŠ¤í…œ
âœ… RoleGuard ì»´í¬ë„ŒíŠ¸
âœ… ì—­í• ë³„ ë©”ë‰´ ìë™ í•„í„°ë§
âœ… ê¸°ë³¸ ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ
```

#### 7.10.2 Phase 2: ì •ì±… ê´€ë¦¬ (6ì£¼)
```
âœ… ì •ì±… ìƒì„± 5ë‹¨ê³„ ìœ„ì €ë“œ
âœ… ë™ì  í¼ ì‹œìŠ¤í…œ
âœ… ë¦¬ë² ì´íŠ¸ ë§¤íŠ¸ë¦­ìŠ¤ ì—ë””í„°
âœ… ì •ì±… ì¡°íšŒ ì „ìš© í˜ì´ì§€ (í˜‘ë ¥ì‚¬/íŒë§¤ì )
```

#### 7.10.3 Phase 3: ì£¼ë¬¸ ì‹œìŠ¤í…œ (6ì£¼)
```
âœ… ë™ì  ì£¼ë¬¸ì„œ ë Œë”ëŸ¬
âœ… ì£¼ë¬¸ ìŠ¹ì¸ í (ë³¸ì‚¬)
âœ… ì£¼ë¬¸ ìƒíƒœ ì¶”ì 
âœ… ë¯¼ê°ì •ë³´ ì²˜ë¦¬
```

#### 7.10.4 Phase 4: ë¦¬ë² ì´íŠ¸ ì‹œìŠ¤í…œ (4ì£¼)
```
âœ… 3ë‹¨ê³„ ë¦¬ë² ì´íŠ¸ íë¦„
âœ… ë¦¬ë² ì´íŠ¸ í• ë‹¹/ë¶„ë°°/ì‚¬ìš©
âœ… ì •ì‚° ìë™í™”
âœ… ìŠ¹ì¸ ì›Œí¬í”Œë¡œìš°
```

#### 7.10.5 Phase 5: ìµœì í™” (3ì£¼)
```
âœ… ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (WebSocket)
âœ… ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì‹œìŠ¤í…œ
âœ… ì„±ëŠ¥ ìµœì í™”
âœ… ë°˜ì‘í˜• ë””ìì¸
```

ì´ ë¬¸ì„œëŠ” DN_Solution2ì˜ í”„ë¡ íŠ¸ì—”ë“œ ë¦¬ëª¨ë¸ë§ì„ ìœ„í•œ ì™„ì „í•œ ì„¤ê³„ ê°€ì´ë“œì…ë‹ˆë‹¤.