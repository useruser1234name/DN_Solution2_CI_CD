# 종합 요약 (Overall Summary)

`DN_solution` 프로젝트는 Django와 Django REST Framework를 기반으로 구축된 백엔드 시스템으로, 계층적인 업체 및 사용자 관리, 주문 처리, 정책 관리 기능을 제공합니다. 이 문서는 프로젝트의 전반적인 구조, 핵심 기능, 그리고 백엔드와 프론트엔드 간의 상호작용에 대한 종합적인 요약을 제공합니다.

## 1. 프로젝트 목표 및 범위

*   **목표:** 다양한 유형의 업체(본사, 협력사, 판매점)와 그 소속 사용자들을 효율적으로 관리하고, 이들 간의 계층적 관계 및 접근 권한을 체계적으로 제어하는 시스템을 구축합니다.
*   **범위:** 업체 및 사용자 관리, 주문 관리, 정책 관리 기능을 포함하는 RESTful API 백엔드 개발을 중심으로 하며, 프론트엔드는 별도로 연동될 수 있도록 설계되었습니다.

## 2. 아키텍처 개요

*   **백엔드:** Django (Python) 기반의 RESTful API 서버. Django REST Framework를 활용하여 API 엔드포인트를 제공합니다. 각 비즈니스 도메인(companies, orders, policies)별로 앱을 분리하여 모듈성을 확보했습니다.
*   **데이터베이스:** Django ORM을 통해 데이터베이스와 상호작용하며, SQLite (개발) 또는 PostgreSQL/MySQL (운영)을 사용할 수 있습니다.
*   **프론트엔드 (예정):** React, Vue.js, Angular 등 SPA 프레임워크를 활용하여 백엔드 API와 연동되는 사용자 인터페이스를 구축할 예정입니다.

## 3. 핵심 기능 및 로직

### 3.1. 업체 및 사용자 관리 (`companies` 앱)

*   **계층적 `Company` 모델:** 본사-협력사-판매점의 3단계 계층 구조를 `parent_company` 필드를 통해 구현합니다. `models.py`의 `clean` 메서드를 통해 계층별 생성 규칙(예: 판매점은 반드시 협력사 하위)을 강제하여 데이터 무결성을 보장합니다.
*   **`CompanyUser` 모델:** 각 업체에 소속된 사용자를 관리하며, `admin`과 `staff` 역할을 가집니다.
*   **권한 제어:** `CompanyViewSet`의 `get_queryset` 메서드에서 로그인한 사용자의 역할에 따라 조회 가능한 업체 및 사용자 목록을 동적으로 필터링합니다. (예: 협력사는 자신과 하위 판매점만 조회 가능).
*   **업체 생성 정책:** 현재 본사는 협력사를 생성할 수 있으며, 유효한 상위 협력사를 지정하는 경우 판매점도 생성할 수 있습니다. 향후 본사의 판매점 직접 생성을 금지하는 정책 강화가 가능합니다.

### 3.2. 주문 관리 (`orders` 앱)

*   고객 주문 정보, 주문 메모, 송장 정보 등을 관리하며, 주문 상태 변경 및 송장 생성 시 자동 업데이트 로직을 포함합니다.

### 3.3. 정책 관리 (`policies` 앱)

*   다양한 정책을 정의하고, 이를 특정 업체에 배정하며, 리베이트 계산 등의 로직을 처리합니다.

## 4. 인증 및 권한

*   **백엔드:** `IsAuthenticated` 권한 클래스를 기본으로 사용하며, `get_queryset` 메서드를 통해 세밀한 객체 레벨 권한 제어를 구현합니다.
*   **프론트엔드:** 사용자의 역할 정보를 기반으로 조건부 렌더링 및 동적 라우팅/내비게이션을 통해 UI 요소를 제어합니다. 이는 사용자 경험을 개선하고 불필요한 정보 노출을 방지하지만, 백엔드에서의 철저한 권한 검증이 필수적인 보안 계층입니다.

## 5. 개발 및 운영 고려사항

*   **모듈화:** 각 비즈니스 도메인별 앱 분리를 통해 코드의 응집도를 높이고 결합도를 낮춥니다.
*   **로깅:** 주요 비즈니스 이벤트 및 시스템 동작을 상세하게 로깅하여 디버깅 및 모니터링을 용이하게 합니다.
*   **테스트:** `companies.tests.py`와 같은 단위 및 통합 테스트를 통해 핵심 로직의 정확성과 안정성을 확보합니다.
*   **가상 환경:** `venv`를 사용하여 개발 환경의 일관성을 유지합니다.

## 6. 결론

`DN_solution` 프로젝트는 견고한 백엔드 아키텍처와 세밀한 권한 제어 로직을 통해 다양한 계층의 업체 및 사용자 관리를 효율적으로 지원합니다. 향후 프론트엔드 개발 시 이 문서에 명시된 UI 접근 제어 전략을 적용하여 사용자에게 최적화된 경험을 제공할 수 있을 것입니다.
