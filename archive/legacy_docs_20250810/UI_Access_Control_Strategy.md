# UI 접근 제어 전략 문서 (DN_solution 프로젝트)

## 1. 개요

이 문서는 `DN_solution` 프로젝트에서 `Company` 및 `CompanyUser` 모델의 계층적 구조와 권한 모델을 기반으로, 사용자 인터페이스(UI) 레벨에서 어떻게 접근을 제어하고 사용자 경험을 최적화할 것인지에 대한 전략을 설명합니다.

**핵심 원칙:**
*   **백엔드 권한(Authorization)이 최우선입니다.** UI는 백엔드에서 이미 제어되는 권한을 시각적으로 반영하고, 사용자에게 불필요한 기능이나 정보를 노출하지 않음으로써 사용자 경험을 개선하고 보안을 강화하는 보조적인 역할을 합니다.
*   사용자의 역할(슈퍼계정, 본사, 협력사, 판매점)에 따라 접근 가능한 메뉴, 버튼, 데이터 등을 명확히 구분하여 표시합니다.

## 2. UI 접근 제어 구현 전략

프론트엔드 애플리케이션(예: React, Vue, Angular 등)에서 사용자의 역할 정보를 활용하여 다음과 같은 방법으로 UI 접근을 제어할 수 있습니다.

### 2.1. 조건부 렌더링 (Conditional Rendering)

사용자의 역할에 따라 특정 UI 요소를 화면에 표시하거나 숨기는 가장 기본적인 방법입니다.

*   **적용 대상:**
    *   **내비게이션 메뉴/사이드바 항목:** 사용자의 역할에 따라 접근 권한이 없는 메뉴 항목은 아예 보여주지 않습니다.
        *   예: 판매점 사용자에게는 '협력사 관리', '본사 설정' 메뉴를 숨김.
    *   **버튼 및 액션:** 특정 작업(생성, 수정, 삭제, 상태 변경 등)을 수행하는 버튼을 권한이 없는 사용자에게는 숨기거나 비활성화(disabled)합니다.
        *   예: 협력사 사용자에게는 다른 협력사를 생성하는 버튼을 숨김.
    *   **데이터 테이블 컬럼/행:** 특정 역할만 볼 수 있는 민감한 정보(예: 다른 업체의 상세 정보)가 포함된 테이블의 컬럼이나 행을 숨깁니다.
    *   **폼 필드:** 특정 역할만 수정할 수 있는 필드(예: 업체의 'type' 변경)는 권한이 없는 사용자에게는 읽기 전용으로 표시하거나 숨깁니다.

*   **구현 방식:**
    *   사용자 로그인 시 백엔드로부터 사용자 역할 정보를 받아와 프론트엔드 상태(state)에 저장합니다.
    *   각 UI 컴포넌트나 템플릿에서 해당 역할 정보를 조건문으로 체크하여 렌더링 여부를 결정합니다.
    ```javascript
    // 예시 (가상의 React 컴포넌트)
    function Navigation({ userRole }) {
      return (
        <nav>
          {userRole === 'headquarters' && <MenuItem title="모든 업체 관리" link="/companies" />}
          {userRole === 'agency' && <MenuItem title="내 협력사 및 판매점" link="/my-companies" />}
          {userRole === 'retail' && <MenuItem title="내 판매점 정보" link="/my-retail" />}
          {/* ... 기타 메뉴 ... */}
        </nav>
      );
    }
    ```

### 2.2. 동적 라우팅/내비게이션 (Dynamic Routing/Navigation)

사용자의 역할에 따라 접근 가능한 페이지(URL 경로)를 제어합니다. 사용자가 권한 없는 페이지의 URL을 직접 입력하여 접근하는 것을 방지합니다.

*   **적용 대상:**
    *   **페이지 라우트:** 특정 역할만 접근 가능한 페이지에 대한 라우트 가드(Route Guard) 또는 미들웨어(Middleware)를 설정합니다.
*   **구현 방식:**
    *   프론트엔드 라우터(예: React Router, Vue Router)에서 각 라우트에 `meta` 필드나 `guard` 함수를 사용하여 필요한 권한을 정의합니다.
    *   내비게이션 발생 시, 라우터는 사용자의 역할과 페이지의 요구 권한을 비교하여 접근을 허용하거나, '권한 없음' 페이지로 리다이렉트합니다.
    ```javascript
    // 예시 (가상의 Vue Router 설정)
    const routes = [
      {
        path: '/admin-dashboard',
        component: AdminDashboard,
        meta: { requiresRole: 'headquarters' }
      },
      {
        path: '/agency-dashboard',
        component: AgencyDashboard,
        meta: { requiresRole: ['headquarters', 'agency'] }
      }
    ];

    router.beforeEach((to, from, next) => {
      const userRole = getUserRole(); // 로그인한 사용자의 역할 가져오기
      if (to.meta.requiresRole && !to.meta.requiresRole.includes(userRole)) {
        next('/unauthorized'); // 권한 없는 페이지로 리다이렉트
      } else {
        next();
      }
    });
    ```

## 3. DN_solution 프로젝트에 대한 적용 방안

`Company` 모델의 `type` 필드(`headquarters`, `agency`, `retail`)와 `CompanyUser`의 `role` 필드(`admin`, `staff`)를 활용하여 UI를 구성합니다.

### 3.1. 슈퍼계정 (Superuser)

*   **권한:** 모든 `Company` 및 `CompanyUser` 데이터에 대한 완전한 접근 및 관리 권한.
*   **UI 반영:** 모든 메뉴 항목, 모든 버튼, 모든 데이터 테이블의 모든 컬럼을 표시합니다. 관리자 대시보드에 대한 완전한 접근 권한을 부여합니다.

### 3.2. 본사 계정 (Company.type = 'headquarters'에 속한 CompanyUser)

*   **권한:**
    *   모든 `Company` (본사, 협력사, 판매점) 정보 조회 및 관리.
    *   모든 `CompanyUser` (본사, 협력사, 판매점 소속) 생성, 조회, 관리.
    *   새로운 협력사 및 판매점 계정 생성.
*   **UI 반영:**
    *   슈퍼계정과 유사하게 대부분의 관리 기능을 제공합니다.
    *   '본사 설정'과 같은 특정 메뉴는 본사 계정만 접근 가능하도록 합니다.
    *   다른 계층의 업체 및 사용자 목록을 조회하고 관리할 수 있는 UI 요소를 제공합니다.

### 3.3. 협력사 계정 (Company.type = 'agency'에 속한 CompanyUser)

*   **권한:**
    *   자신이 소속된 협력사 정보 조회 및 관리.
    *   자신이 `parent_company`로 지정된 하위 판매점 정보 조회 및 관리.
    *   자신이 소속된 협력사 및 하위 판매점의 `CompanyUser` 생성, 조회, 관리.
    *   **다른 협력사 또는 본사의 정보에는 접근 불가.**
*   **UI 반영:**
    *   '내 협력사 정보', '내 판매점 관리'와 같은 메뉴를 제공합니다.
    *   다른 협력사나 본사 관련 메뉴는 숨기거나 비활성화합니다.
    *   판매점 생성 버튼은 제공하되, 상위 업체 선택 시 자신의 협력사로 자동 지정되거나 선택지가 제한되도록 합니다.
    *   사용자 생성 시, 소속 업체 선택지를 자신의 협력사 또는 하위 판매점으로 제한합니다.

### 3.4. 판매점 계정 (Company.type = 'retail'에 속한 CompanyUser)

*   **권한:**
    *   자신이 소속된 판매점 정보만 조회 및 관리.
    *   자신이 소속된 판매점의 `CompanyUser` (직원) 생성, 조회, 관리.
    *   **다른 업체(본사, 협력사, 다른 판매점)의 정보에는 접근 불가.**
*   **UI 반영:**
    *   '내 판매점 정보', '내 직원 관리'와 같은 최소한의 메뉴만 제공합니다.
    *   다른 업체 관련 메뉴는 모두 숨기거나 비활성화합니다.
    *   사용자 생성 시, 소속 업체 선택지를 자신의 판매점으로 고정합니다.

## 4. 기술적 고려사항

*   **인증 후 역할 정보 획득:** 사용자가 로그인에 성공하면, 백엔드 API는 JWT 토큰 등과 함께 사용자의 역할 정보를 포함하여 응답해야 합니다. 프론트엔드는 이 정보를 안전하게 저장하고(예: Local Storage, Vuex, Redux 등) 전역적으로 접근 가능하도록 관리합니다.
*   **프론트엔드 프레임워크 활용:** React, Vue, Angular 등 최신 프론트엔드 프레임워크는 컴포넌트 기반 개발과 상태 관리를 통해 조건부 렌더링 및 라우팅 가드를 쉽게 구현할 수 있도록 지원합니다.
*   **보안 경고:** UI 레벨의 제어는 사용자 경험을 위한 것이며, 악의적인 사용자가 UI를 우회하여 직접 API 요청을 보낼 수 있습니다. 따라서 **백엔드에서의 철저한 권한 검증은 필수적**이며, UI 제어는 추가적인 방어 계층으로 간주해야 합니다.

이 문서는 UI 개발 시 참조하여 각 사용자 역할에 맞는 적절한 접근 제어 및 화면 구성을 구현하는 데 도움이 될 것입니다.
